/* empty css                                                                    */import{_ as Pn,r as Je,d as We,c as $e,j as X,p as Un,F as Bn,n as kn,q as wr,b as Ms,u as Ir,t as Or,e as br}from"./index-DYM_3iik.js";import{a as hn}from"./api-util-D4KrbgeV.js";import{C as Us,V as Ze,a as Ct,b as It,M as Dr,c as Fr,E as Gn,d as Hn,L as ns,S as zr,e as Pr,I as Ur,f as Br,D as Wn,g as kr,h as Gr,F as $n,i as Bs,N as pn,j as Hr,W as Wr,k as Xn,l as $r,m as Xr,U as qr,n as jr,o as Yr,p as Jr,q as Zr,T as mn,O as Kr,r as As,s as Qr,R as ea,t as ta,A as sa,u as na,v as oa,B as ia,w as fn,x as Rs,H as ra,P as aa,y as ca,z as qn,G as ua,J as la,K as jn,Q as da,X as Yn,Y as ha,Z as pa,_ as ma,$ as fa,a0 as ga,a1 as Na,a2 as ya}from"./three.module-BhVQLMGn.js";import"./request-DanhXGOG.js";const xa={trace(...n){console.log("%c%s","color: #4C4C4C; background: white; font-size: 14px;","[trace]:",n)},info(...n){console.info("%c%s","color: #000000; background: white; font-size: 14px;","[info]:",n)},debug(...n){console.log("%c%s","color: #91D300; background: white; font-size: 14px;","[debug]",n)},warn(...n){console.warn("%c%s","color: #FA9D3B; background: white; font-size: 14px;","[warn]:",n)},error(...n){console.error("%c%s","color: red; background: white; font-size: 14px;","[error]:",n)}},Ta={class:"color-picker"},va={key:0},Va={style:{display:"flex","align-items":"center"}},_a=["value"],Sa={style:{display:"flex","align-items":"center","margin-top":"8px"}},Ea=["onClick"],Ma={__name:"ColorPicker",props:{},emits:["onChange"],setup(n,{emit:e}){const t=e,s=Je(!1),o=Je("#ff7bbc"),i=Je([{color:"#F36FF3"},{color:"#ff7272"},{color:"#FFD860"},{color:"#52cc6f"},{color:"#00c7ff"},{color:"#FFFFFF"}]),r=()=>{var u=document.getElementById("checkbox");u.checked?(s.value=!0,t("onChange",o.value)):(s.value=!1,t("onChange",""))},a=u=>{const l=u.target.value;o.value=l,t("onChange",o.value)},c=u=>{console.log("onColorClick",u),o.value=u.color,t("onChange",o.value)};return(u,l)=>(We(),$e("div",Ta,[X("div",{style:{margin:"16px 0"}},[l[0]||(l[0]=Un("Custom Font Color: ")),X("input",{id:"checkbox",type:"checkbox",value:"1",onClick:r})]),s.value?(We(),$e("div",va,[X("div",Va,[l[1]||(l[1]=X("div",{style:{"margin-right":"6px"}},"Font Color:",-1)),X("input",{type:"color",value:o.value,onInput:a},null,40,_a)]),X("div",Sa,[l[2]||(l[2]=X("div",{style:{"margin-right":"8px"}},"Preset:",-1)),(We(!0),$e(Bn,null,kn(i.value,m=>(We(),$e("div",{key:m,style:wr({background:m.color}),class:"color-item",onClick:f=>c(m)},null,12,Ea))),128))])])):Ms("",!0)]))}},Aa=Pn(Ma,[["__scopeId","data-v-5f467f36"]]),gn={VERTEX:"vertex",FRAGMENT:"fragment"},ee={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},ks=["x","y","z","w"];function Jn(n){let e="{";n.isNode===!0&&(e+=n.id);for(const{property:t,childNode:s}of qt(n))e+=","+t.slice(0,-4)+":"+s.getCacheKey();return e+="}",e}function*qt(n,e=!1){for(const t in n){if(t.startsWith("_")===!0)continue;const s=n[t];if(Array.isArray(s)===!0)for(let o=0;o<s.length;o++){const i=s[o];i&&(i.isNode===!0||e&&typeof i.toJSON=="function")&&(yield{property:t,index:o,childNode:i})}else if(s&&s.isNode===!0)yield{property:t,childNode:s};else if(typeof s=="object")for(const o in s){const i=s[o];i&&(i.isNode===!0||e&&typeof i.toJSON=="function")&&(yield{property:t,index:o,childNode:i})}}}function it(n){if(n==null)return null;const e=typeof n;return n.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":n.isVector2===!0?"vec2":n.isVector3===!0?"vec3":n.isVector4===!0?"vec4":n.isMatrix3===!0?"mat3":n.isMatrix4===!0?"mat4":n.isColor===!0?"color":n instanceof ArrayBuffer?"ArrayBuffer":null}function Zn(n,...e){const t=n?n.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),n==="color"?new Us(...e):t==="vec2"?new Ze(...e):t==="vec3"?new Ct(...e):t==="vec4"?new It(...e):t==="mat3"?new Dr(...e):t==="mat4"?new Fr(...e):n==="bool"?e[0]||!1:n==="float"||n==="int"||n==="uint"?e[0]||0:n==="string"?e[0]||"":n==="ArrayBuffer"?Qn(e[0]):null}function Kn(n){let e="";const t=new Uint8Array(n);for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return btoa(e)}function Qn(n){return Uint8Array.from(atob(n),e=>e.charCodeAt(0)).buffer}const Nn=new Map;let Ra=0;class R extends Gn{constructor(e=null){super(),this.nodeType=e,this.updateType=ee.NONE,this.updateBeforeType=ee.NONE,this.uuid=Hn.generateUUID(),this.isNode=!0,Object.defineProperty(this,"id",{value:Ra++})}get type(){return this.constructor.type}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return!1}*getChildren(){for(const{childNode:e}of qt(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(){return Jn(this)}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);for(const s of this.getChildren())t["_node"+s.id]=s;return null}construct(e){return console.warn("THREE.Node: construct() is deprecated. Use setup() instead."),this.setup(e)}analyze(e){const t=e.getDataFromNode(this);if(t.dependenciesCount=t.dependenciesCount===void 0?1:t.dependenciesCount+1,t.dependenciesCount===1){const s=e.getNodeProperties(this);for(const o of Object.values(s))o&&o.isNode===!0&&o.build(e)}}generate(e,t){const{outputNode:s}=e.getNodeProperties(this);if(s&&s.isNode===!0)return s.build(e,t)}updateBefore(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const s=this.getShared(e);if(this!==s)return s.build(e,t);e.addNode(this),e.addChain(this);let o=null;const i=e.getBuildStage();if(i==="setup"){const r=e.getNodeProperties(this);if(r.initialized!==!0||e.context.tempRead===!1){const a=e.stack.nodes.length;r.initialized=!0,r.outputNode=this.setup(e),r.outputNode!==null&&e.stack.nodes.length!==a&&(r.outputNode=e.stack);for(const c of Object.values(r))c&&c.isNode===!0&&c.build(e)}}else if(i==="analyze")this.analyze(e);else if(i==="generate")if(this.generate.length===1){const a=this.getNodeType(e),c=e.getDataFromNode(this);o=c.snippet,o===void 0&&(o=this.generate(e)||"",c.snippet=o),o=e.format(o,a,t)}else o=this.generate(e,t)||"";return e.removeChain(this),o}getSerializeChildren(){return qt(this)}serialize(e){const t=this.getSerializeChildren(),s={};for(const{property:o,index:i,childNode:r}of t)i!==void 0?(s[o]===void 0&&(s[o]=Number.isInteger(i)?[]:{}),s[o][i]=r.toJSON(e.meta).uuid):s[o]=r.toJSON(e.meta).uuid;Object.keys(s).length>0&&(e.inputNodes=s)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const s in e.inputNodes)if(Array.isArray(e.inputNodes[s])){const o=[];for(const i of e.inputNodes[s])o.push(t[i]);this[s]=o}else if(typeof e.inputNodes[s]=="object"){const o={};for(const i in e.inputNodes[s]){const r=e.inputNodes[s][i];o[i]=t[r]}this[s]=o}else{const o=e.inputNodes[s];this[s]=t[o]}}}toJSON(e){const{uuid:t,type:s}=this,o=e===void 0||typeof e=="string";o&&(e={textures:{},images:{},nodes:{}});let i=e.nodes[t];i===void 0&&(i={uuid:t,type:s,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},o!==!0&&(e.nodes[i.uuid]=i),this.serialize(i),delete i.meta);function r(a){const c=[];for(const u in a){const l=a[u];delete l.metadata,c.push(l)}return c}if(o){const a=r(e.textures),c=r(e.images),u=r(e.nodes);a.length>0&&(i.textures=a),c.length>0&&(i.images=c),u.length>0&&(i.nodes=u)}return i}}function T(n,e){if(typeof e!="function"||!n)throw new Error(`Node class ${n} is not a class`);if(Nn.has(n)){console.warn(`Redefinition of node class ${n}`);return}Nn.set(n,e),e.type=n}class os extends R{constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?it(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=it(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=Kn(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?Zn(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}T("InputNode",os);class Gs extends R{constructor(e,t=!1){super("string"),this.name=e,this.version=0,this.shared=t,this.isUniformGroup=!0}set needsUpdate(e){e===!0&&this.version++}}const Ca=n=>new Gs(n),eo=n=>new Gs(n,!0);eo("frame");eo("render");const La=Ca("object");T("UniformGroupNode",Gs);class Hs extends R{constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getNodeType(e)}generate(e){const t=this.node.build(e),s=this.indexNode.build(e,"uint");return`${t}[ ${s} ]`}}T("ArrayElementNode",Hs);class Ws extends R{constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let s=null;for(const o of this.convertTo.split("|"))(s===null||e.getTypeLength(t)===e.getTypeLength(o))&&(s=o);return s}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const s=this.node,o=this.getNodeType(e),i=s.build(e,o);return e.format(i,o,t)}}T("ConvertNode",Ws);class $ extends R{constructor(e){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).dependenciesCount>1}build(e,t){if(e.getBuildStage()==="generate"){const o=e.getVectorType(this.getNodeType(e,t)),i=e.getDataFromNode(this);if(e.context.tempRead!==!1&&i.propertyName!==void 0)return e.format(i.propertyName,o,t);if(e.context.tempWrite!==!1&&o!=="void"&&t!=="void"&&this.hasDependencies(e)){const r=super.build(e,o),a=e.getVarFromNode(this,null,o),c=e.getPropertyName(a);return e.addLineFlowCode(`${c} = ${r}`),i.snippet=r,i.propertyName=c,e.format(i.propertyName,o,t)}}return super.build(e,t)}}T("TempNode",$);class to extends ${constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,s)=>t+e.getTypeLength(s.getNodeType(e)),0))}generate(e,t){const s=this.getNodeType(e),o=this.nodes,i=e.getPrimitiveType(s),r=[];for(const c of o){let u=c.build(e);const l=e.getPrimitiveType(c.getNodeType(e));l!==i&&(u=e.format(u,l,i)),r.push(u)}const a=`${e.getType(s)}( ${r.join(", ")} )`;return e.format(a,s,t)}}T("JoinNode",to);const wa=ks.join("");class Cs extends R{constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(ks.indexOf(t)+1,e);return e}getPrimitiveType(e){return e.getPrimitiveType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getPrimitiveType(e))}generate(e,t){const s=this.node,o=e.getTypeLength(s.getNodeType(e));let i=null;if(o>1){let r=null;this.getVectorLength()>=o&&(r=e.getTypeFromLength(this.getVectorLength(),this.getPrimitiveType(e)));const c=s.build(e,r);this.components.length===o&&this.components===wa.slice(0,this.components.length)?i=e.format(c,r,t):i=e.format(`${c}.${this.components}`,this.getNodeType(e),t)}else i=s.build(e,t);return i}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}T("SplitNode",Cs);class so extends ${constructor(e,t,s){super(),this.sourceNode=e,this.components=t,this.targetNode=s}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:s,targetNode:o}=this,i=this.getNodeType(e),r=e.getTypeFromLength(s.length),a=o.build(e,r),c=t.build(e,i),u=e.getTypeLength(i),l=[];for(let m=0;m<u;m++){const f=ks[m];f===s[0]?(l.push(a),m+=s.length-1):l.push(c+"."+f)}return`${e.getType(i)}( ${l.join(", ")} )`}}T("SetNode",so);class Ie extends os{constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const s=this.getNodeType(e);return e.format(this.generateConst(e),s,t)}}T("ConstNode",Ie);let vt=null;const mt=new Map;function g(n,e){if(mt.has(n)){console.warn(`Redefinition of node element ${n}`);return}if(typeof e!="function")throw new Error(`Node element ${n} is not a function`);mt.set(n,e)}const yn=n=>n.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),no={setup(n,e){const t=e.shift();return n(as(t),...e)},get(n,e,t){if(typeof e=="string"&&n[e]===void 0){if(n.isStackNode!==!0&&e==="assign")return(...s)=>(vt.assign(t,...s),t);if(mt.has(e)){const s=mt.get(e);return n.isStackNode?(...o)=>t.add(s(...o)):(...o)=>s(t,...o)}else{if(e==="self")return n;if(e.endsWith("Assign")&&mt.has(e.slice(0,e.length-6))){const s=mt.get(e.slice(0,e.length-6));return n.isStackNode?(...o)=>t.assign(o[0],s(...o)):(...o)=>t.assign(s(t,...o))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=yn(e),A(new Cs(t,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=yn(e.slice(3).toLowerCase()),e=e.split("").sort().join(""),s=>A(new so(n,e,s));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),A(new Cs(n,e));if(/^\d+$/.test(e)===!0)return A(new Hs(t,new Ie(Number(e),"uint")))}}}return Reflect.get(n,e,t)},set(n,e,t,s){return typeof e=="string"&&n[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(s[e].assign(t),!0):Reflect.set(n,e,t,s)}},ps=new WeakMap,xn=new WeakMap,Ia=function(n,e=null){const t=it(n);if(t==="node"){let s=ps.get(n);return s===void 0&&(s=new Proxy(n,no),ps.set(n,s),ps.set(s,s)),s}else{if(e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string")return A(Ls(n,e));if(t==="shader")return v(n)}return n},Oa=function(n,e=null){for(const t in n)n[t]=A(n[t],e);return n},ba=function(n,e=null){const t=n.length;for(let s=0;s<t;s++)n[s]=A(n[s],e);return n},Da=function(n,e=null,t=null,s=null){const o=i=>A(s!==null?Object.assign(i,s):i);return e===null?(...i)=>o(new n(...Nt(i))):t!==null?(t=A(t),(...i)=>o(new n(e,...Nt(i),t))):(...i)=>o(new n(e,...Nt(i)))},Fa=function(n,...e){return A(new n(...Nt(e)))};class za extends R{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t}getNodeType(e){const{outputNode:t}=e.getNodeProperties(this);return t?t.getNodeType(e):super.getNodeType(e)}call(e){const{shaderNode:t,inputNodes:s}=this;if(t.layout){let r=xn.get(e.constructor);r===void 0&&(r=new WeakMap,xn.set(e.constructor,r));let a=r.get(t);return a===void 0&&(a=A(e.buildFunctionNode(t)),r.set(t,a)),e.currentFunctionNode!==null&&e.currentFunctionNode.includes.push(a),A(a.call(s))}const o=t.jsFunc,i=s!==null?o(s,e.stack,e):o(e.stack,e);return A(i)}setup(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,t){const{outputNode:s}=e.getNodeProperties(this);return s===null?this.call(e).build(e,t):super.generate(e,t)}}class Pa extends R{constructor(e){super(),this.jsFunc=e,this.layout=null}get isArrayInput(){return/^\(\s+?\[/.test(this.jsFunc.toString())}setLayout(e){return this.layout=e,this}call(e=null){return as(e),A(new za(this,e))}setup(){return this.call()}}const Ua=[!1,!0],Ba=[0,1,2,3],ka=[-1,-2],oo=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],$s=new Map;for(const n of Ua)$s.set(n,new Ie(n));const Xs=new Map;for(const n of Ba)Xs.set(n,new Ie(n,"uint"));const qs=new Map([...Xs].map(n=>new Ie(n.value,"int")));for(const n of ka)qs.set(n,new Ie(n,"int"));const is=new Map([...qs].map(n=>new Ie(n.value)));for(const n of oo)is.set(n,new Ie(n));for(const n of oo)is.set(-n,new Ie(-n));const rs={bool:$s,uint:Xs,ints:qs,float:is},Tn=new Map([...$s,...is]),Ls=(n,e)=>Tn.has(n)?Tn.get(n):n.isNode===!0?n:new Ie(n,e),Ga=n=>{try{return n.getNodeType()}catch{return}},W=function(n,e=null){return(...t)=>{if((t.length===0||!["bool","float","int","uint"].includes(n)&&t.every(o=>typeof o!="object"))&&(t=[Zn(n,...t)]),t.length===1&&e!==null&&e.has(t[0]))return A(e.get(t[0]));if(t.length===1){const o=Ls(t[0],n);return Ga(o)===n?A(o):A(new Ws(o,n))}const s=t.map(o=>Ls(o));return A(new to(s,n))}},Ha=n=>n!=null?n.nodeType||n.convertTo||(typeof n=="string"?n:null):null;function Lt(n){return new Proxy(new Pa(n),no)}const A=(n,e=null)=>Ia(n,e),as=(n,e=null)=>new Oa(n,e),Nt=(n,e=null)=>new ba(n,e),N=(...n)=>new Da(...n),S=(...n)=>new Fa(...n),v=n=>{const e=new Lt(n),t=(...s)=>{let o;return as(s),s[0]&&s[0].isNode?o=[...s]:o=s[0],e.call(o)};return t.shaderNode=e,t.setLayout=s=>(e.setLayout(s),t),t};T("ShaderNode",Lt);const vn=n=>{vt=n},Wa=()=>vt,G=(...n)=>vt.if(...n);function $a(n){return vt&&vt.add(n),n}g("append",$a);const Xa=new W("color"),h=new W("float",rs.float),d=new W("int",rs.int),E=new W("uint",rs.uint),qe=new W("bool",rs.bool),C=new W("vec2"),io=new W("ivec2"),qa=new W("uvec2"),ja=new W("bvec2"),y=new W("vec3"),Ya=new W("ivec3"),Ut=new W("uvec3"),ro=new W("bvec3"),P=new W("vec4"),Ja=new W("ivec4"),Za=new W("uvec4"),Ka=new W("bvec4"),Vt=new W("mat3"),Qa=new W("imat3"),ec=new W("umat3"),tc=new W("bmat3"),ao=new W("mat4"),sc=new W("imat4"),nc=new W("umat4"),oc=new W("bmat4"),ic=(n="")=>A(new Ie(n,"string")),rc=n=>A(new Ie(n,"ArrayBuffer"));g("color",Xa);g("float",h);g("int",d);g("uint",E);g("bool",qe);g("vec2",C);g("ivec2",io);g("uvec2",qa);g("bvec2",ja);g("vec3",y);g("ivec3",Ya);g("uvec3",Ut);g("bvec3",ro);g("vec4",P);g("ivec4",Ja);g("uvec4",Za);g("bvec4",Ka);g("mat3",Vt);g("imat3",Qa);g("umat3",ec);g("bmat3",tc);g("mat4",ao);g("imat4",sc);g("umat4",nc);g("bmat4",oc);g("string",ic);g("arrayBuffer",rc);const ac=N(Hs),cc=(n,e)=>A(new Ws(A(n),e));g("element",ac);g("convert",cc);class et extends os{constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.groupNode=La}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}generate(e,t){const s=this.getNodeType(e),o=this.getUniformHash(e);let i=e.getNodeFromHash(o);i===void 0&&(e.setHashNode(this,o),i=this);const r=i.getInputType(e),a=e.getUniformFromNode(i,r,e.shaderStage,e.context.label),c=e.getPropertyName(a);return e.context.label!==void 0&&delete e.context.label,e.format(c,s,t)}}const Z=(n,e)=>{const t=Ha(e||n),s=n&&n.isNode===!0?n.node&&n.node.value||n.value:n;return A(new et(s,t))};T("UniformNode",et);class uc extends et{constructor(e=[]){super(),this.isArrayUniformNode=!0,this.nodes=e}getNodeType(e){return this.nodes[0].getNodeType(e)}}T("ArrayUniformNode",uc);class co extends ${constructor(e,t){super(),this.targetNode=e,this.sourceNode=t}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}generate(e,t){const s=this.targetNode,o=this.sourceNode,i=s.getNodeType(e),r=s.build(e),a=o.build(e,i),c=`${r} = ${a}`;if(t==="void"){e.addLineFlowCode(c);return}else return o.getNodeType(e)==="void"?(e.addLineFlowCode(c),r):e.format(c,i,t)}}const lc=N(co);T("AssignNode",co);g("assign",lc);class uo extends R{constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{name:t,node:s}=this,o=this.getNodeType(e),i=e.getVaryingFromNode(this,t,o);i.needsInterpolation||(i.needsInterpolation=e.shaderStage==="fragment");const r=e.getPropertyName(i,gn.VERTEX);return e.flowNodeFromShaderStage(gn.VERTEX,s,o,r),e.getPropertyName(i)}}const J=N(uo);g("varying",J);T("VaryingNode",uo);class js extends R{constructor(e,t=null){super(t),this._attributeName=e}isGlobal(){return!0}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=super.getNodeType(e);if(t===null){const s=this.getAttributeName(e);if(e.hasGeometryAttribute(s)){const o=e.geometry.getAttribute(s);t=e.getTypeFromAttribute(o)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),s=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const i=e.geometry.getAttribute(t),r=e.getTypeFromAttribute(i),a=e.getAttribute(t,r);return e.shaderStage==="vertex"?e.format(a.name,r,s):J(this).build(e,s)}else return console.warn(`AttributeNode: Attribute "${t}" not found.`),e.generateConst(s)}}const Ne=(n,e)=>A(new js(n,e));T("AttributeNode",js);class lo extends R{constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t),this.outputNode.build(e)}}const ho=N(lo);g("bypass",ho);T("BypassNode",lo);let dc=0;class hc{constructor(){this.id=dc++,this.nodesData=new WeakMap}getNodeData(e){return this.nodesData.get(e)}setNodeData(e,t){this.nodesData.set(e,t)}}class po extends R{constructor(e,t=new hc){super(),this.isCacheNode=!0,this.node=e,this.cache=t}getNodeType(e){return this.node.getNodeType(e)}build(e,...t){const s=e.getCache(),o=this.cache||e.globalCache;e.setCache(o);const i=this.node.build(e,...t);return e.setCache(s),i}}const jt=N(po),pc=n=>jt(n,null);g("cache",jt);g("globalCache",pc);T("CacheNode",po);class Ys extends R{constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.context=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.context});const s=this.node.build(e);return e.setContext(t),s}generate(e,t){const s=e.getContext();e.setContext({...e.context,...this.context});const o=this.node.build(e,t);return e.setContext(s),o}}const Xe=N(Ys),mo=(n,e)=>Xe(n,{label:e});g("context",Xe);g("label",mo);T("ContextNode",Ys);class Pe extends R{constructor(e){super("uint"),this.scope=e,this.isInstanceIndexNode=!0}generate(e){const t=this.getNodeType(e),s=this.scope;let o;if(s===Pe.VERTEX)o=e.getVertexIndex();else if(s===Pe.INSTANCE)o=e.getInstanceIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+s);let i;return e.shaderStage==="vertex"||e.shaderStage==="compute"?i=o:i=J(this).build(e,t),i}}Pe.VERTEX="vertex";Pe.INSTANCE="instance";const mc=S(Pe,Pe.VERTEX),fc=S(Pe,Pe.INSTANCE);T("IndexNode",Pe);class fo{start(){}finish(){}direct(){}indirectDiffuse(){}indirectSpecular(){}ambientOcclusion(){}}class go extends R{constructor(e,t=null){super(),this.node=e,this.name=t,this.isVarNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:s}=this,o=e.getVarFromNode(this,s,e.getVectorType(this.getNodeType(e))),i=e.getPropertyName(o),r=t.build(e,o.type);return e.addLineFlowCode(`${i} = ${r}`),i}}const Ot=N(go);g("temp",Ot);g("toVar",(...n)=>Ot(...n).append());T("VarNode",go);class te extends R{constructor(e,t=null,s=!1){super(e),this.name=t,this.varying=s,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const Ce=(n,e)=>A(new te(n,e)),Ye=(n,e)=>A(new te(n,e,!0)),ge=S(te,"vec4","DiffuseColor"),wt=S(te,"float","Roughness"),gc=S(te,"float","Metalness"),ws=S(te,"float","Clearcoat"),Yt=S(te,"float","ClearcoatRoughness"),ft=S(te,"vec3","Sheen"),Js=S(te,"float","SheenRoughness"),Zs=S(te,"float","Iridescence"),No=S(te,"float","IridescenceIOR"),yo=S(te,"float","IridescenceThickness"),Ge=S(te,"color","SpecularColor"),Is=S(te,"float","Shininess"),Nc=S(te,"vec4","Output"),yt=S(te,"float","dashSize"),Jt=S(te,"float","gapSize");S(te,"float","pointWidth");T("PropertyNode",te);class yc extends te{constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}T("ParameterNode",yc);class Ks extends R{constructor(e="",t=[],s=""){super("code"),this.isCodeNode=!0,this.code=e,this.language=s,this.includes=t}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const o of t)o.build(e);const s=e.getCodeFromNode(this,this.getNodeType(e));return s.code=this.code,s.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}N(Ks);T("CodeNode",Ks);class xc extends Ks{constructor(e="",t=[],s=""){super(e,t,s),this.keywords={}}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let s=t.nodeFunction;return s===void 0&&(s=e.parser.parseFunction(this.code),t.nodeFunction=s),s}generate(e,t){super.generate(e);const s=this.getNodeFunction(e),o=s.name,i=s.type,r=e.getCodeFromNode(this,i);o!==""&&(r.name=o);const a=e.getPropertyName(r);let c=this.getNodeFunction(e).getCode(a);const u=this.keywords,l=Object.keys(u);if(l.length>0)for(const m of l){const f=new RegExp(`\\b${m}\\b`,"g"),x=u[m].build(e,"property");c=c.replace(f,x)}return r.code=c+`
`,t==="property"?a:e.format(`${a}()`,i,t)}}T("FunctionNode",xc);class xo extends js{constructor(e=0){super(null,"vec2"),this.isUVNode=!0,this.index=e}getAttributeName(){const e=this.index;return"uv"+(e>0?e:"")}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const tt=(...n)=>A(new xo(...n));T("UVNode",xo);class To extends R{constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const s=this.textureNode.build(e,"property"),o=this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${s}, ${o} )`,this.getNodeType(e),t)}}const vo=N(To);g("textureSize",vo);T("TextureSizeNode",To);class Y extends ${constructor(e,t,s,...o){if(super(),this.op=e,o.length>0){let i=s;for(let r=0;r<o.length;r++)i=new Y(e,i,o[r]);s=i}this.aNode=t,this.bNode=s}getNodeType(e,t){const s=this.op,o=this.aNode,i=this.bNode,r=o.getNodeType(e),a=i.getNodeType(e);if(r==="void"||a==="void")return"void";if(s==="%")return r;if(s==="&"||s==="|"||s==="^"||s===">>"||s==="<<")return e.getIntegerType(r);if(s==="=="||s==="&&"||s==="||"||s==="^^")return"bool";if(s==="<"||s===">"||s==="<="||s===">="){const c=t?e.getTypeLength(t):Math.max(e.getTypeLength(r),e.getTypeLength(a));return c>1?`bvec${c}`:"bool"}else return r==="float"&&e.isMatrix(a)?a:e.isMatrix(r)&&e.isVector(a)?e.getVectorFromMatrix(r):e.isVector(r)&&e.isMatrix(a)?e.getVectorFromMatrix(a):e.getTypeLength(a)>e.getTypeLength(r)?a:r}generate(e,t){const s=this.op,o=this.aNode,i=this.bNode,r=this.getNodeType(e,t);let a=null,c=null;r!=="void"?(a=o.getNodeType(e),c=i.getNodeType(e),s==="<"||s===">"||s==="<="||s===">="||s==="=="?e.isVector(a)?c=a:a=c="float":s===">>"||s==="<<"?(a=r,c=e.changeComponentType(c,"uint")):e.isMatrix(a)&&e.isVector(c)?c=e.getVectorFromMatrix(a):e.isVector(a)&&e.isMatrix(c)?a=e.getVectorFromMatrix(c):a=c=r):a=c=r;const u=o.build(e,a),l=i.build(e,c),m=e.getTypeLength(t),f=e.getFunctionOperator(s);if(t!=="void")return s==="<"&&m>1?e.format(`${e.getMethod("lessThan")}( ${u}, ${l} )`,r,t):s==="<="&&m>1?e.format(`${e.getMethod("lessThanEqual")}( ${u}, ${l} )`,r,t):s===">"&&m>1?e.format(`${e.getMethod("greaterThan")}( ${u}, ${l} )`,r,t):s===">="&&m>1?e.format(`${e.getMethod("greaterThanEqual")}( ${u}, ${l} )`,r,t):f?e.format(`${f}( ${u}, ${l} )`,r,t):e.format(`( ${u} ${s} ${l} )`,r,t);if(a!=="void")return f?e.format(`${f}( ${u}, ${l} )`,r,t):e.format(`${u} ${s} ${l}`,r,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const Le=N(Y,"+"),he=N(Y,"-"),q=N(Y,"*"),bt=N(Y,"/"),Tc=N(Y,"%"),vc=N(Y,"=="),Vc=N(Y,"!="),_c=N(Y,"<"),Vo=N(Y,">"),Sc=N(Y,"<="),Ec=N(Y,">="),Mc=N(Y,"&&"),Ac=N(Y,"||"),Rc=N(Y,"^^"),Cc=N(Y,"&"),Lc=N(Y,"|"),wc=N(Y,"^"),Ic=N(Y,"<<"),Oc=N(Y,">>");g("add",Le);g("sub",he);g("mul",q);g("div",bt);g("remainder",Tc);g("equal",vc);g("notEqual",Vc);g("lessThan",_c);g("greaterThan",Vo);g("lessThanEqual",Sc);g("greaterThanEqual",Ec);g("and",Mc);g("or",Ac);g("xor",Rc);g("bitAnd",Cc);g("bitOr",Lc);g("bitXor",wc);g("shiftLeft",Ic);g("shiftRight",Oc);T("OperatorNode",Y);class p extends ${constructor(e,t,s=null,o=null){super(),this.method=e,this.aNode=t,this.bNode=s,this.cNode=o}getInputType(e){const t=this.aNode.getNodeType(e),s=this.bNode?this.bNode.getNodeType(e):null,o=this.cNode?this.cNode.getNodeType(e):null,i=e.isMatrix(t)?0:e.getTypeLength(t),r=e.isMatrix(s)?0:e.getTypeLength(s),a=e.isMatrix(o)?0:e.getTypeLength(o);return i>r&&i>a?t:r>a?s:a>i?o:t}getNodeType(e){const t=this.method;return t===p.LENGTH||t===p.DISTANCE||t===p.DOT?"float":t===p.CROSS?"vec3":this.getInputType(e)}generate(e,t){const s=this.method,o=this.getNodeType(e),i=this.getInputType(e),r=this.aNode,a=this.bNode,c=this.cNode,u=e.renderer.isWebGLRenderer===!0;if(s===p.TRANSFORM_DIRECTION){let l=r,m=a;e.isMatrix(l.getNodeType(e))?m=P(y(m),0):l=P(y(l),0);const f=q(l,m).xyz;return we(f).build(e,t)}else{if(s===p.NEGATE)return e.format("( - "+r.build(e,i)+" )",o,t);if(s===p.ONE_MINUS)return he(1,r).build(e,t);if(s===p.RECIPROCAL)return bt(1,r).build(e,t);if(s===p.DIFFERENCE)return Re(he(r,a)).build(e,t);{const l=[];return s===p.CROSS?l.push(r.build(e,o),a.build(e,o)):s===p.STEP?l.push(r.build(e,e.getTypeLength(r.getNodeType(e))===1?"float":i),a.build(e,i)):u&&(s===p.MIN||s===p.MAX)||s===p.MOD?l.push(r.build(e,i),a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":i)):s===p.REFRACT?l.push(r.build(e,i),a.build(e,i),c.build(e,"float")):s===p.MIX?l.push(r.build(e,i),a.build(e,i),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":i)):(l.push(r.build(e,i)),a!==null&&l.push(a.build(e,i)),c!==null&&l.push(c.build(e,i))),e.format(`${e.getMethod(s)}( ${l.join(", ")} )`,o,t)}}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}p.RADIANS="radians";p.DEGREES="degrees";p.EXP="exp";p.EXP2="exp2";p.LOG="log";p.LOG2="log2";p.SQRT="sqrt";p.INVERSE_SQRT="inversesqrt";p.FLOOR="floor";p.CEIL="ceil";p.NORMALIZE="normalize";p.FRACT="fract";p.SIN="sin";p.COS="cos";p.TAN="tan";p.ASIN="asin";p.ACOS="acos";p.ATAN="atan";p.ABS="abs";p.SIGN="sign";p.LENGTH="length";p.NEGATE="negate";p.ONE_MINUS="oneMinus";p.DFDX="dFdx";p.DFDY="dFdy";p.ROUND="round";p.RECIPROCAL="reciprocal";p.TRUNC="trunc";p.FWIDTH="fwidth";p.BITCAST="bitcast";p.ATAN2="atan2";p.MIN="min";p.MAX="max";p.MOD="mod";p.STEP="step";p.REFLECT="reflect";p.DISTANCE="distance";p.DIFFERENCE="difference";p.DOT="dot";p.CROSS="cross";p.POW="pow";p.TRANSFORM_DIRECTION="transformDirection";p.MIX="mix";p.CLAMP="clamp";p.REFRACT="refract";p.SMOOTHSTEP="smoothstep";p.FACEFORWARD="faceforward";const _o=h(1e-6);h(1e6);const bc=N(p,p.RADIANS),Dc=N(p,p.DEGREES),Fc=N(p,p.EXP),zc=N(p,p.EXP2),Pc=N(p,p.LOG),Uc=N(p,p.LOG2),dt=N(p,p.SQRT),Bc=N(p,p.INVERSE_SQRT),Bt=N(p,p.FLOOR),So=N(p,p.CEIL),we=N(p,p.NORMALIZE),Qs=N(p,p.FRACT),kc=N(p,p.SIN),Gc=N(p,p.COS),Hc=N(p,p.TAN),Wc=N(p,p.ASIN),$c=N(p,p.ACOS),Xc=N(p,p.ATAN),Re=N(p,p.ABS),qc=N(p,p.SIGN),jc=N(p,p.LENGTH),Yc=N(p,p.NEGATE),Jc=N(p,p.ONE_MINUS),Zc=N(p,p.DFDX),Kc=N(p,p.DFDY),Qc=N(p,p.ROUND),eu=N(p,p.RECIPROCAL),Eo=N(p,p.TRUNC),tu=N(p,p.FWIDTH);N(p,p.BITCAST);const su=N(p,p.ATAN2),Dt=N(p,p.MIN),rt=N(p,p.MAX),nu=N(p,p.MOD),ou=N(p,p.STEP),iu=N(p,p.REFLECT),ru=N(p,p.DISTANCE),au=N(p,p.DIFFERENCE),kt=N(p,p.DOT),cu=N(p,p.CROSS),en=N(p,p.POW),uu=N(p,p.POW,2),lu=N(p,p.POW,3),du=N(p,p.POW,4),hu=N(p,p.TRANSFORM_DIRECTION),ke=N(p,p.MIX),Mo=(n,e=0,t=1)=>A(new p(p.CLAMP,A(n),A(e),A(t))),pu=n=>Mo(n),mu=N(p,p.REFRACT),at=N(p,p.SMOOTHSTEP),fu=N(p,p.FACEFORWARD),gu=(n,e,t)=>ke(e,t,n),Nu=(n,e,t)=>at(e,t,n);g("radians",bc);g("degrees",Dc);g("exp",Fc);g("exp2",zc);g("log",Pc);g("log2",Uc);g("sqrt",dt);g("inverseSqrt",Bc);g("floor",Bt);g("ceil",So);g("normalize",we);g("fract",Qs);g("sin",kc);g("cos",Gc);g("tan",Hc);g("asin",Wc);g("acos",$c);g("atan",Xc);g("abs",Re);g("sign",qc);g("length",jc);g("negate",Yc);g("oneMinus",Jc);g("dFdx",Zc);g("dFdy",Kc);g("round",Qc);g("reciprocal",eu);g("trunc",Eo);g("fwidth",tu);g("atan2",su);g("min",Dt);g("max",rt);g("mod",nu);g("step",ou);g("reflect",iu);g("distance",ru);g("dot",kt);g("cross",cu);g("pow",en);g("pow2",uu);g("pow3",lu);g("pow4",du);g("transformDirection",hu);g("mix",gu);g("clamp",Mo);g("refract",mu);g("smoothstep",Nu);g("faceForward",fu);g("difference",au);g("saturate",pu);T("MathNode",p);const yu=v(n=>{const{value:e}=n,{rgb:t}=e,s=t.mul(.9478672986).add(.0521327014).pow(2.4),o=t.mul(.0773993808),i=t.lessThanEqual(.04045),r=ke(s,o,i);return P(r,e.a)}),xu=v(n=>{const{value:e}=n,{rgb:t}=e,s=t.pow(.41666).mul(1.055).sub(.055),o=t.mul(12.92),i=t.lessThanEqual(.0031308),r=ke(s,o,i);return P(r,e.a)}),Vn=n=>{let e=null;return n===ns?e="Linear":n===zr&&(e="sRGB"),e},Ao=(n,e)=>Vn(n)+"To"+Vn(e);class _e extends ${constructor(e,t){super("vec4"),this.method=e,this.node=t}setup(){const{method:e,node:t}=this;return e===_e.LINEAR_TO_LINEAR?t:Tu[e]({value:t})}}_e.LINEAR_TO_LINEAR="LinearToLinear";_e.LINEAR_TO_sRGB="LinearTosRGB";_e.sRGB_TO_LINEAR="sRGBToLinear";const Tu={[_e.LINEAR_TO_sRGB]:xu,[_e.sRGB_TO_LINEAR]:yu},vu=(n,e)=>A(new _e(Ao(ns,e),A(n))),Ro=(n,e)=>A(new _e(Ao(e,ns),A(n))),Vu=N(_e,_e.LINEAR_TO_sRGB),_u=N(_e,_e.sRGB_TO_LINEAR);g("linearTosRGB",Vu);g("sRGBToLinear",_u);g("linearToColorSpace",vu);g("colorSpaceToLinear",Ro);T("ColorSpaceNode",_e);class Co extends R{constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const s=this.getNodeType(e),o=this.snippet;if(s==="void")e.addLineFlowCode(o);else return e.format(`( ${o} )`,s,t)}}const tn=N(Co);T("ExpressionNode",Co);class Lo extends et{constructor(e){super(0),this.textureNode=e,this.updateType=ee.FRAME}get texture(){return this.textureNode.value}update(){const e=this.texture,t=e.images,s=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(s&&s.width!==void 0){const{width:o,height:i}=s;this.value=Math.log2(Math.max(o,i))}}}const sn=N(Lo);T("MaxMipLevelNode",Lo);class _t extends et{constructor(e,t=null,s=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=s,this.compareNode=null,this.depthNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=ee.NONE,this.setUpdateMatrix(t===null)}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":"vec4"}getInputType(){return"texture"}getDefaultUV(){return tt(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){const t=this.value;return Z(t.matrix).mul(y(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?ee.FRAME:ee.NONE,this}setupUV(e,t){const s=this.value;return e.isFlipY()&&(s.isRenderTargetTexture===!0||s.isFramebufferTexture===!0||s.isDepthTexture===!0)&&(t=t.setY(t.y.oneMinus())),t}setup(e){const t=e.getNodeProperties(this);let s=this.uvNode;(s===null||e.context.forceUVContext===!0)&&e.context.getUV&&(s=e.context.getUV(this)),s||(s=this.getDefaultUV()),this.updateMatrix===!0&&(s=this.getTransformedUV(s)),s=this.setupUV(e,s);let o=this.levelNode;o===null&&e.context.getTextureLevel&&(o=e.context.getTextureLevel(this)),o!==null&&e.context.getTextureLevelAlgorithm!==void 0&&(o=e.context.getTextureLevelAlgorithm(this,o)),t.uvNode=s,t.levelNode=o,t.compareNode=this.compareNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,t,s,o,i,r){const a=this.value;let c;return o?c=e.generateTextureLevel(a,t,s,o,i):r?c=e.generateTextureCompare(a,t,s,r,i):this.sampler===!1?c=e.generateTextureLoad(a,t,s,i):c=e.generateTexture(a,t,s,i),c}generate(e,t){const s=e.getNodeProperties(this),o=this.value;if(!o||o.isTexture!==!0)throw new Error("TextureNode: Need a three.js texture.");const i=super.generate(e,"property");if(t==="sampler")return i+"_sampler";if(e.isReference(t))return i;{const r=e.getDataFromNode(this);let a=r.propertyName;if(a===void 0){const{uvNode:l,levelNode:m,compareNode:f,depthNode:x}=s,V=this.generateUV(e,l),M=m?m.build(e,"float"):null,w=x?x.build(e,"int"):null,L=f?f.build(e,"float"):null,b=e.getVarFromNode(this);a=e.getPropertyName(b);const I=this.generateSnippet(e,i,V,M,w,L);e.addLineFlowCode(`${a} = ${I}`),e.context.tempWrite!==!1&&(r.snippet=I,r.propertyName=a)}let c=a;const u=this.getNodeType(e);return e.needsColorSpaceToLinear(o)&&(c=Ro(tn(c,u),o.colorSpace).setup(e).build(e,u)),e.format(c,u,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){const t=this.clone();return t.uvNode=e,A(t)}blur(e){const t=this.clone();return t.levelNode=e.mul(sn(t)),A(t)}level(e){const t=this.clone();return t.levelNode=e,t}size(e){return vo(this,e)}compare(e){const t=this.clone();return t.compareNode=A(e),A(t)}depth(e){const t=this.clone();return t.depthNode=A(e),A(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value]}update(){const e=this.value;e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e}}const De=N(_t),Su=(...n)=>De(...n).setSampler(!1);g("texture",De);T("TextureNode",_t);class Gt extends R{constructor(e,t,s=null){super(),this.property=e,this.index=null,this.uniformType=t,this.object=s,this.reference=null,this.node=null,this.updateType=ee.OBJECT,this.setNodeType(t)}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setIndex(e){return this.index=e,this}getIndex(){return this.index}setNodeType(e){let t=null;e==="texture"?t=De(null):t=Z(e),this.node=t}getNodeType(e){return this.node.getNodeType(e)}update(){let e=this.reference[this.property];this.index!==null&&(e=e[this.index]),this.node.value=e}setup(){return this.node}}const ct=(n,e,t)=>A(new Gt(n,e,t)),Eu=(n,e,t,s)=>A(new Gt(n,t,s).setIndex(e));T("ReferenceNode",Gt);class wo extends Gt{constructor(e,t,s=null){super(e,t,s),this.material=s}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}setup(e){const t=this.material!==null?this.material:e.material;return this.node.value=t[this.property],super.setup(e)}}const Mu=(n,e,t)=>A(new wo(n,e,t));T("MaterialReferenceNode",wo);class O extends R{constructor(e=O.VIEW_MATRIX,t=null){super(),this.scope=e,this.object3d=t,this.updateType=ee.OBJECT,this._uniformNode=new et(null)}getNodeType(){const e=this.scope;if(e===O.WORLD_MATRIX||e===O.VIEW_MATRIX)return"mat4";if(e===O.NORMAL_MATRIX)return"mat3";if(e===O.POSITION||e===O.VIEW_POSITION||e===O.DIRECTION||e===O.SCALE)return"vec3"}update(e){const t=this.object3d,s=this._uniformNode,o=this.scope;if(o===O.VIEW_MATRIX)s.value=t.modelViewMatrix;else if(o===O.NORMAL_MATRIX)s.value=t.normalMatrix;else if(o===O.WORLD_MATRIX)s.value=t.matrixWorld;else if(o===O.POSITION)s.value=s.value||new Ct,s.value.setFromMatrixPosition(t.matrixWorld);else if(o===O.SCALE)s.value=s.value||new Ct,s.value.setFromMatrixScale(t.matrixWorld);else if(o===O.DIRECTION)s.value=s.value||new Ct,t.getWorldDirection(s.value);else if(o===O.VIEW_POSITION){const i=e.camera;s.value=s.value||new Ct,s.value.setFromMatrixPosition(t.matrixWorld),s.value.applyMatrix4(i.matrixWorldInverse)}}generate(e){const t=this.scope;return t===O.WORLD_MATRIX||t===O.VIEW_MATRIX?this._uniformNode.nodeType="mat4":t===O.NORMAL_MATRIX?this._uniformNode.nodeType="mat3":(t===O.POSITION||t===O.VIEW_POSITION||t===O.DIRECTION||t===O.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}O.VIEW_MATRIX="viewMatrix";O.NORMAL_MATRIX="normalMatrix";O.WORLD_MATRIX="worldMatrix";O.POSITION="position";O.SCALE="scale";O.VIEW_POSITION="viewPosition";O.DIRECTION="direction";N(O,O.DIRECTION);N(O,O.VIEW_MATRIX);N(O,O.NORMAL_MATRIX);N(O,O.WORLD_MATRIX);const Os=N(O,O.POSITION);N(O,O.SCALE);const Io=N(O,O.VIEW_POSITION);T("Object3DNode",O);class F extends O{constructor(e=F.POSITION){super(e),this.updateType=ee.RENDER}getNodeType(e){const t=this.scope;return t===F.PROJECTION_MATRIX?"mat4":t===F.NEAR||t===F.FAR||t===F.LOG_DEPTH?"float":super.getNodeType(e)}update(e){const t=e.camera,s=this._uniformNode,o=this.scope;o===F.VIEW_MATRIX?s.value=t.matrixWorldInverse:o===F.PROJECTION_MATRIX?s.value=t.projectionMatrix:o===F.NEAR?s.value=t.near:o===F.FAR?s.value=t.far:o===F.LOG_DEPTH?s.value=2/(Math.log(t.far+1)/Math.LN2):(this.object3d=t,super.update(e))}generate(e){const t=this.scope;return t===F.PROJECTION_MATRIX?this._uniformNode.nodeType="mat4":(t===F.NEAR||t===F.FAR||t===F.LOG_DEPTH)&&(this._uniformNode.nodeType="float"),super.generate(e)}}F.PROJECTION_MATRIX="projectionMatrix";F.NEAR="near";F.FAR="far";F.LOG_DEPTH="logDepth";const He=mo(S(F,F.PROJECTION_MATRIX),"projectionMatrix"),ms=S(F,F.NEAR),fs=S(F,F.FAR),Au=S(F,F.LOG_DEPTH),st=S(F,F.VIEW_MATRIX);S(F,F.NORMAL_MATRIX);S(F,F.WORLD_MATRIX);S(F,F.POSITION);T("CameraNode",F);class fe extends O{constructor(e=fe.VIEW_MATRIX){super(e)}update(e){this.object3d=e.object,super.update(e)}}S(fe,fe.DIRECTION);const ut=S(fe,fe.VIEW_MATRIX).label("modelViewMatrix").temp("ModelViewMatrix"),Oo=S(fe,fe.NORMAL_MATRIX),Zt=S(fe,fe.WORLD_MATRIX);S(fe,fe.POSITION);S(fe,fe.SCALE);S(fe,fe.VIEW_POSITION);T("ModelNode",fe);class se extends R{constructor(e=se.LOCAL){super("vec3"),this.scope=e}isGlobal(){return!0}getHash(){return`normal-${this.scope}`}generate(e){const t=this.scope;let s=null;if(t===se.GEOMETRY)s=Ne("normal","vec3");else if(t===se.LOCAL)s=J(Kt);else if(t===se.VIEW){const o=Oo.mul(je);s=we(J(o))}else if(t===se.WORLD){const o=Qe.transformDirection(st);s=we(J(o))}return s.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}se.GEOMETRY="geometry";se.LOCAL="local";se.VIEW="view";se.WORLD="world";const Kt=S(se,se.GEOMETRY),je=S(se,se.LOCAL).temp("Normal"),Qe=S(se,se.VIEW),bo=S(se,se.WORLD),Q=Ce("vec3","TransformedNormalView"),Ru=Q.transformDirection(st).normalize(),gt=Ce("vec3","TransformedClearcoatNormalView");T("NormalNode",se);const _n=new Map;class _ extends R{constructor(e){super(),this.scope=e}getCache(e,t){let s=_n.get(e);return s===void 0&&(s=Mu(e,t),_n.set(e,s)),s}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,s=this.scope;let o=null;if(s===_.COLOR){const i=this.getColor(s);t.map&&t.map.isTexture===!0?o=i.mul(this.getTexture("map")):o=i}else if(s===_.OPACITY){const i=this.getFloat(s);t.alphaMap&&t.alphaMap.isTexture===!0?o=i.mul(this.getTexture("alpha")):o=i}else if(s===_.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?o=this.getTexture(s).r:o=h(1);else if(s===_.ROUGHNESS){const i=this.getFloat(s);t.roughnessMap&&t.roughnessMap.isTexture===!0?o=i.mul(this.getTexture(s).g):o=i}else if(s===_.METALNESS){const i=this.getFloat(s);t.metalnessMap&&t.metalnessMap.isTexture===!0?o=i.mul(this.getTexture(s).b):o=i}else if(s===_.EMISSIVE){const i=this.getColor(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?o=i.mul(this.getTexture(s)):o=i}else if(s===_.NORMAL)t.normalMap?o=this.getTexture("normal").normalMap(this.getCache("normalScale","vec2")):t.bumpMap?o=this.getTexture("bump").r.bumpMap(this.getFloat("bumpScale")):o=Qe;else if(s===_.CLEARCOAT){const i=this.getFloat(s);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?o=i.mul(this.getTexture(s).r):o=i}else if(s===_.CLEARCOAT_ROUGHNESS){const i=this.getFloat(s);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?o=i.mul(this.getTexture(s).r):o=i}else if(s===_.CLEARCOAT_NORMAL)t.clearcoatNormalMap?o=this.getTexture(s).normalMap(this.getCache(s+"Scale","vec2")):o=Qe;else if(s===_.SHEEN){const i=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?o=i.mul(this.getTexture("sheenColor").rgb):o=i}else if(s===_.SHEEN_ROUGHNESS){const i=this.getFloat(s);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?o=i.mul(this.getTexture(s).a):o=i,o=o.clamp(.07,1)}else if(s===_.IRIDESCENCE_THICKNESS){const i=ct(1,"float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const r=ct(0,"float",t.iridescenceThicknessRange);o=i.sub(r).mul(this.getTexture(s).g).add(r)}else o=i}else{const i=this.getNodeType(e);o=this.getCache(s,i)}return o}}_.ALPHA_TEST="alphaTest";_.COLOR="color";_.OPACITY="opacity";_.SHININESS="shininess";_.SPECULAR_COLOR="specular";_.SPECULAR_STRENGTH="specularStrength";_.REFLECTIVITY="reflectivity";_.ROUGHNESS="roughness";_.METALNESS="metalness";_.NORMAL="normal";_.CLEARCOAT="clearcoat";_.CLEARCOAT_ROUGHNESS="clearcoatRoughness";_.CLEARCOAT_NORMAL="clearcoatNormal";_.EMISSIVE="emissive";_.ROTATION="rotation";_.SHEEN="sheen";_.SHEEN_ROUGHNESS="sheenRoughness";_.IRIDESCENCE="iridescence";_.IRIDESCENCE_IOR="iridescenceIOR";_.IRIDESCENCE_THICKNESS="iridescenceThickness";_.LINE_SCALE="scale";_.LINE_DASH_SIZE="dashSize";_.LINE_GAP_SIZE="gapSize";_.LINE_WIDTH="linewidth";_.LINE_DASH_OFFSET="dashOffset";_.POINT_WIDTH="pointWidth";const Cu=S(_,_.ALPHA_TEST),Ft=S(_,_.COLOR),Lu=S(_,_.SHININESS),wu=S(_,_.EMISSIVE),Do=S(_,_.OPACITY),Iu=S(_,_.SPECULAR_COLOR),Ou=S(_,_.SPECULAR_STRENGTH);S(_,_.REFLECTIVITY);const bu=S(_,_.ROUGHNESS),Du=S(_,_.METALNESS),Fu=S(_,_.NORMAL),zu=S(_,_.CLEARCOAT),Pu=S(_,_.CLEARCOAT_ROUGHNESS),Uu=S(_,_.CLEARCOAT_NORMAL),Bu=S(_,_.ROTATION),ku=S(_,_.SHEEN),Gu=S(_,_.SHEEN_ROUGHNESS),Hu=S(_,_.IRIDESCENCE),Wu=S(_,_.IRIDESCENCE_IOR),$u=S(_,_.IRIDESCENCE_THICKNESS),bs=S(_,_.LINE_SCALE),Fo=S(_,_.LINE_DASH_SIZE),zo=S(_,_.LINE_GAP_SIZE),At=S(_,_.LINE_WIDTH),Sn=S(_,_.LINE_DASH_OFFSET),Xu=S(_,_.POINT_WIDTH);T("MaterialNode",_);class k extends R{constructor(e=k.LOCAL){super("vec3"),this.scope=e}isGlobal(){return!0}getHash(){return`position-${this.scope}`}generate(e){const t=this.scope;let s=null;if(t===k.GEOMETRY)s=Ne("position","vec3");else if(t===k.LOCAL)s=J(ye);else if(t===k.WORLD){const o=Zt.mul(ve);s=J(o)}else if(t===k.VIEW){const o=ut.mul(ve);s=J(o)}else if(t===k.VIEW_DIRECTION){const o=Ue.negate();s=we(J(o))}else if(t===k.WORLD_DIRECTION){const o=ve.transformDirection(Zt);s=we(J(o))}return s.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}k.GEOMETRY="geometry";k.LOCAL="local";k.WORLD="world";k.WORLD_DIRECTION="worldDirection";k.VIEW="view";k.VIEW_DIRECTION="viewDirection";const ye=S(k,k.GEOMETRY),ve=S(k,k.LOCAL).temp("Position"),qu=S(k,k.WORLD),ju=S(k,k.WORLD_DIRECTION),Ue=S(k,k.VIEW),ce=S(k,k.VIEW_DIRECTION);T("PositionNode",k);class Po extends ${constructor(e=null){super("vec4"),this.positionNode=e}setup(e){if(e.shaderStage==="fragment")return J(e.context.mvp);const t=this.positionNode||ve;return He.mul(ut).mul(t)}}const En=N(Po);T("ModelViewProjectionNode",Po);class Uo extends os{constructor(e,t=null,s=0,o=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=s,this.bufferOffset=o,this.usage=Pr,this.instanced=!1,this.attribute=null,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),s=this.value,o=e.getTypeLength(t),i=this.bufferStride||o,r=this.bufferOffset,a=s.isInterleavedBuffer===!0?s:new Ur(s,i),c=new Br(a,o,r);a.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),s=e.getBufferAttributeFromNode(this,t),o=e.getPropertyName(s);let i=null;return e.shaderStage==="vertex"?i=o:i=J(this).build(e,t),i}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this}setInstanced(e){return this.instanced=e,this}}const nn=(n,e,t,s)=>A(new Uo(n,e,t,s)),Yu=(n,e,t,s)=>nn(n,e,t,s).setUsage(Wn),Ju=(n,e,t,s)=>nn(n,e,t,s).setInstanced(!0),Zu=(n,e,t,s)=>Yu(n,e,t,s).setInstanced(!0);g("toAttribute",n=>nn(n.value));T("BufferAttributeNode",Uo);class Bo extends R{constructor(e){super("void"),this.instanceMesh=e,this.instanceMatrixNode=null}setup(){let e=this.instanceMatrixNode;if(e===null){const a=this.instanceMesh.instanceMatrix,c=new kr(a.array,16,1),u=a.usage===Wn?Zu:Ju,l=[u(c,"vec4",16,0),u(c,"vec4",16,4),u(c,"vec4",16,8),u(c,"vec4",16,12)];e=ao(...l),this.instanceMatrixNode=e}const t=e.mul(ve).xyz,s=Vt(e[0].xyz,e[1].xyz,e[2].xyz),o=je.div(y(s[0].dot(s[0]),s[1].dot(s[1]),s[2].dot(s[2]))),i=s.mul(o).xyz;ve.assign(t),je.assign(i)}}const Ku=N(Bo);T("InstanceNode",Bo);class on extends et{constructor(e,t,s=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=s}getInputType(){return"buffer"}}const ko=(n,e,t)=>A(new on(n,e,t));T("BufferNode",on);class K extends R{constructor(e=K.LOCAL){super(),this.scope=e}getHash(){return`tangent-${this.scope}`}getNodeType(){return this.scope===K.GEOMETRY?"vec4":"vec3"}generate(e){const t=this.scope;let s=null;if(t===K.GEOMETRY)s=Ne("tangent","vec4");else if(t===K.LOCAL)s=J(Qt.xyz);else if(t===K.VIEW){const o=ut.mul(rn).xyz;s=we(J(o))}else if(t===K.WORLD){const o=cs.transformDirection(st);s=we(J(o))}return s.build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}K.GEOMETRY="geometry";K.LOCAL="local";K.VIEW="view";K.WORLD="world";const Qt=S(K,K.GEOMETRY),rn=S(K,K.LOCAL),cs=S(K,K.VIEW),Qu=S(K,K.WORLD),Go=Ot(cs,"TransformedTangentView");we(Go.transformDirection(st));T("TangentNode",K);class Ho extends R{constructor(e){super("void"),this.skinnedMesh=e,this.updateType=ee.OBJECT,this.skinIndexNode=Ne("skinIndex","uvec4"),this.skinWeightNode=Ne("skinWeight","vec4"),this.bindMatrixNode=Z(e.bindMatrix,"mat4"),this.bindMatrixInverseNode=Z(e.bindMatrixInverse,"mat4"),this.boneMatricesNode=ko(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)}setup(e){const{skinIndexNode:t,skinWeightNode:s,bindMatrixNode:o,bindMatrixInverseNode:i,boneMatricesNode:r}=this,a=r.element(t.x),c=r.element(t.y),u=r.element(t.z),l=r.element(t.w),m=o.mul(ve),f=Le(a.mul(s.x).mul(m),c.mul(s.y).mul(m),u.mul(s.z).mul(m),l.mul(s.w).mul(m)),x=i.mul(f).xyz;let V=Le(s.x.mul(a),s.y.mul(c),s.z.mul(u),s.w.mul(l));V=i.mul(V).mul(o);const M=V.transformDirection(je).xyz;ve.assign(x),je.assign(M),e.hasGeometryAttribute("tangent")&&rn.assign(M)}generate(e,t){if(t!=="void")return ve.build(e,t)}update(){this.skinnedMesh.skeleton.update()}}const el=N(Ho);T("SkinningNode",Ho);const gs=new WeakMap,Se=new It,Mn=v(({bufferMap:n,influence:e,stride:t,width:s,depth:o,offset:i})=>{const r=d(mc).mul(t).add(i),a=r.div(s),c=r.sub(a.mul(s));return Su(n,io(c,a)).depth(o).mul(e)});function tl(n){const e=n.morphAttributes.position!==void 0,t=n.morphAttributes.normal!==void 0,s=n.morphAttributes.color!==void 0,o=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,i=o!==void 0?o.length:0;let r=gs.get(n);if(r===void 0||r.count!==i){let L=function(){M.dispose(),gs.delete(n),n.removeEventListener("dispose",L)};r!==void 0&&r.texture.dispose();const a=n.morphAttributes.position||[],c=n.morphAttributes.normal||[],u=n.morphAttributes.color||[];let l=0;e===!0&&(l=1),t===!0&&(l=2),s===!0&&(l=3);let m=n.attributes.position.count*l,f=1;const x=4096;m>x&&(f=Math.ceil(m/x),m=x);const V=new Float32Array(m*f*4*i),M=new Gr(V,m,f,i);M.type=$n,M.needsUpdate=!0;const w=l*4;for(let b=0;b<i;b++){const I=a[b],D=c[b],de=u[b],z=m*f*4*b;for(let ie=0;ie<I.count;ie++){const re=ie*w;e===!0&&(Se.fromBufferAttribute(I,ie),V[z+re+0]=Se.x,V[z+re+1]=Se.y,V[z+re+2]=Se.z,V[z+re+3]=0),t===!0&&(Se.fromBufferAttribute(D,ie),V[z+re+4]=Se.x,V[z+re+5]=Se.y,V[z+re+6]=Se.z,V[z+re+7]=0),s===!0&&(Se.fromBufferAttribute(de,ie),V[z+re+8]=Se.x,V[z+re+9]=Se.y,V[z+re+10]=Se.z,V[z+re+11]=de.itemSize===4?Se.w:1)}}r={count:i,texture:M,stride:l,size:new Ze(m,f)},gs.set(n,r),n.addEventListener("dispose",L)}return r}class Wo extends R{constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Z(1),this.updateType=ee.OBJECT}setup(e){const{geometry:t}=e,s=t.morphAttributes.position!==void 0,o=t.morphAttributes.normal!==void 0,i=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,r=i!==void 0?i.length:0,{texture:a,stride:c,size:u}=tl(t);s===!0&&ve.mulAssign(this.morphBaseInfluence),o===!0&&je.mulAssign(this.morphBaseInfluence);const l=d(u.width);for(let m=0;m<r;m++){const f=Eu("morphTargetInfluences",m,"float"),x=d(m);s===!0&&ve.addAssign(Mn({bufferMap:a,influence:f,stride:c,width:l,depth:x,offset:d(0)})),o===!0&&je.addAssign(Mn({bufferMap:a,influence:f,stride:c,width:l,depth:x,offset:d(1)}))}}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,s)=>t+s,0)}}const sl=N(Wo);T("MorphNode",Wo);class $o extends R{constructor(){super("vec3")}getHash(){return"reflectVector"}setup(){return ce.negate().reflect(Q).transformDirection(st)}}const nl=S($o);T("ReflectVectorNode",$o);class Xo extends _t{constructor(e,t=null,s=null){super(e,t,s),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){return nl}setUpdateMatrix(){}setupUV(e,t){return y(t.x.negate(),t.yz)}generateUV(e,t){return t.build(e,"vec3")}}const an=N(Xo);g("cubeTexture",an);T("CubeTextureNode",Xo);class us extends R{constructor(){super("vec3")}generate(){console.warn("Abstract function.")}}T("LightingNode",us);let Ns=null;class ht extends us{constructor(e=null){super(),this.updateType=ee.FRAME,this.light=e,this.rtt=null,this.shadowNode=null,this.color=new Us,this._defaultColorNode=Z(this.color),this.colorNode=this._defaultColorNode,this.isAnalyticLightNode=!0}getCacheKey(){return super.getCacheKey()+"-"+(this.light.id+"-"+(this.light.castShadow?"1":"0"))}getHash(){return this.light.uuid}setupShadow(e){let t=this.shadowNode;if(t===null){Ns===null&&(Ns=e.createNodeMaterial("MeshBasicNodeMaterial"));const s=this.light.shadow,o=e.getRenderTarget(s.mapSize.width,s.mapSize.height),i=new Bs;i.minFilter=pn,i.magFilter=pn,i.image.width=s.mapSize.width,i.image.height=s.mapSize.height,i.compareFunction=Hr,o.depthTexture=i,s.camera.updateProjectionMatrix();const r=ct("bias","float",s),a=ct("normalBias","float",s);let c=Z(s.matrix).mul(qu.add(bo.mul(a)));c=c.xyz.div(c.w);const u=c.x.greaterThanEqual(0).and(c.x.lessThanEqual(1)).and(c.y.greaterThanEqual(0)).and(c.y.lessThanEqual(1)).and(c.z.lessThanEqual(1));let l=c.z.add(r);e.renderer.coordinateSystem===Wr&&(l=l.mul(2).sub(1)),c=y(c.x,c.y.oneMinus(),l),t=((f,x,V)=>De(f,x).compare(V))(i,c.xy,c.z),this.rtt=o,this.colorNode=this.colorNode.mul(u.mix(1,t)),this.shadowNode=t,this.updateBeforeType=ee.RENDER}}setup(e){this.light.castShadow?this.setupShadow(e):this.shadowNode!==null&&this.disposeShadow()}updateShadow(e){const{rtt:t,light:s}=this,{renderer:o,scene:i}=e,r=i.overrideMaterial;i.overrideMaterial=Ns,t.setSize(s.shadow.mapSize.width,s.shadow.mapSize.height),s.shadow.updateMatrices(s);const a=o.getRenderTarget(),c=o.getRenderObjectFunction();o.setRenderObjectFunction((u,...l)=>{u.castShadow===!0&&o.renderObject(u,...l)}),o.setRenderTarget(t),o.render(i,s.shadow.camera),o.setRenderTarget(a),o.setRenderObjectFunction(c),i.overrideMaterial=r}disposeShadow(){this.rtt.dispose(),this.shadowNode=null,this.rtt=null,this.colorNode=this._defaultColorNode}updateBefore(e){const{light:t}=this;t.castShadow&&this.updateShadow(e)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}T("AnalyticLightNode",ht);const es=new WeakMap,ol=n=>n.sort((e,t)=>e.id-t.id);class il extends R{constructor(e=[]){super("vec3"),this.totalDiffuseNode=y().temp("totalDiffuse"),this.totalSpecularNode=y().temp("totalSpecular"),this.outgoingLightNode=y().temp("outgoingLight"),this.lightNodes=e,this._hash=null}get hasLight(){return this.lightNodes.length>0}getHash(){if(this._hash===null){const e=[];for(const t of this.lightNodes)e.push(t.getHash());this._hash="lights-"+e.join(",")}return this._hash}setup(e){const t=e.context,s=t.lightingModel;let o=this.outgoingLightNode;if(s){const{lightNodes:i,totalDiffuseNode:r,totalSpecularNode:a}=this;t.outgoingLight=o;const c=e.addStack();s.start(t,c,e);for(const w of i)w.build(e);s.indirectDiffuse(t,c,e),s.indirectSpecular(t,c,e),s.ambientOcclusion(t,c,e);const{backdrop:u,backdropAlpha:l}=t,{directDiffuse:m,directSpecular:f,indirectDiffuse:x,indirectSpecular:V}=t.reflectedLight;let M=m.add(x);u!==null&&(M=y(l!==null?l.mix(M,u):u)),r.assign(M),a.assign(f.add(V)),o.assign(r.add(a)),s.finish(t,c,e),o=o.bypass(e.removeStack())}return o}_getLightNodeById(e){for(const t of this.lightNodes)if(t.isAnalyticLightNode&&t.light.id===e)return t;return null}fromLights(e=[]){const t=[];e=ol(e);for(const s of e){let o=this._getLightNodeById(s.id);if(o===null){const i=s.constructor,r=es.has(i)?es.get(i):ht;o=A(new r(s))}t.push(o)}return this.lightNodes=t,this._hash=null,this}}const rl=N(il);function St(n,e){if(es.has(n)){console.warn(`Redefinition of light node ${e.type}`);return}if(typeof n!="function")throw new Error(`Light ${n.name} is not a class`);if(typeof e!="function"||!e.type)throw new Error(`Light node ${e.type} is not a class`);es.set(n,e)}class qo extends us{constructor(e=null){super(),this.aoNode=e}setup(e){const s=this.aoNode.x.sub(1).mul(1).add(1);e.context.ambientOcclusion.mulAssign(s)}}T("AONode",qo);class jo extends Ys{constructor(e,t=null,s=null,o=null){super(e),this.lightingModel=t,this.backdropNode=s,this.backdropAlphaNode=o,this._context=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,s=y().temp("directDiffuse"),o=y().temp("directSpecular"),i=y().temp("indirectDiffuse"),r=y().temp("indirectSpecular"),a={directDiffuse:s,directSpecular:o,indirectDiffuse:i,indirectSpecular:r};return{radiance:y().temp("radiance"),irradiance:y().temp("irradiance"),iblIrradiance:y().temp("iblIrradiance"),ambientOcclusion:h(1).temp("ambientOcclusion"),reflectedLight:a,backdrop:e,backdropAlpha:t}}setup(e){return this.context=this._context||(this._context=this.getContext()),this.context.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const Yo=N(jo);g("lightingContext",Yo);T("LightingContextNode",jo);class Jo extends ${constructor(e=ju){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan2(e.x).mul(1/(Math.PI*2)).add(.5),s=e.y.negate().clamp(-1,1).asin().mul(1/Math.PI).add(.5);return C(t,s)}}const Zo=N(Jo);T("EquirectUVNode",Jo);class Ko extends R{constructor(e,t=null){super("float"),this.textureNode=e,this.roughnessNode=t}setup(){const{textureNode:e,roughnessNode:t}=this,s=sn(e),o=t.mul(t).mul(Math.PI).div(t.add(1));return s.add(o.log2()).clamp(0,s)}}const al=N(Ko);T("SpecularMIPLevelNode",Ko);const An=new WeakMap;class Qo extends us{constructor(e=null){super(),this.envNode=e}setup(e){let t=this.envNode;if(t.isTextureNode&&t.value.isCubeTexture!==!0){let c=An.get(t.value);if(c===void 0){const u=t.value,l=e.renderer,m=e.getCubeRenderTarget(512).fromEquirectangularTexture(l,u);c=an(m.texture),An.set(t.value,c)}t=c}const s=ct("envMapIntensity","float",e.material),o=Xe(t,Rn(wt,Q)).mul(s),i=Xe(t,cl(Ru)).mul(Math.PI).mul(s),r=jt(o);e.context.radiance.addAssign(r),e.context.iblIrradiance.addAssign(i);const a=e.context.lightingModel.clearcoatRadiance;if(a){const c=Xe(t,Rn(Yt,gt)).mul(s),u=jt(c);a.addAssign(u)}}}const Rn=(n,e)=>{let t=null,s=null;return{getUV:o=>{let i=null;return t===null&&(t=ce.negate().reflect(e),t=n.mul(n).mix(t,e).normalize(),t=t.transformDirection(st)),o.isCubeTextureNode?i=t:o.isTextureNode&&(s===null&&(s=Zo(t)),i=s),i},getTextureLevel:()=>n,getTextureLevelAlgorithm:(o,i)=>al(o,i)}},cl=n=>{let e=null;return{getUV:t=>{let s=null;return t.isCubeTextureNode?s=n:t.isTextureNode&&(e===null&&(e=Zo(n),e=C(e.x,e.y.oneMinus())),s=e),s},getTextureLevel:t=>sn(t)}};T("EnvironmentNode",Qo);let ys,xs;class U extends R{constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===U.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=ee.NONE;return(this.scope===U.RESOLUTION||this.scope===U.VIEWPORT)&&(e=ee.FRAME),this.updateType=e,e}update({renderer:e}){this.scope===U.VIEWPORT?e.getViewport(xs):e.getDrawingBufferSize(ys)}setup(){const e=this.scope;if(e===U.COORDINATE)return;let t=null;if(e===U.RESOLUTION)t=Z(ys||(ys=new Ze));else if(e===U.VIEWPORT)t=Z(xs||(xs=new It));else{t=ul.div(Cn);let s=t.x,o=t.y;/bottom/i.test(e)&&(o=o.oneMinus()),/right/i.test(e)&&(s=s.oneMinus()),t=C(s,o)}return t}generate(e){if(this.scope===U.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const s=e.getNodeProperties(Cn).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${s}.y - ${t}.y )`}return t}return super.generate(e)}}U.COORDINATE="coordinate";U.RESOLUTION="resolution";U.VIEWPORT="viewport";U.TOP_LEFT="topLeft";U.BOTTOM_LEFT="bottomLeft";U.TOP_RIGHT="topRight";U.BOTTOM_RIGHT="bottomRight";const ul=S(U,U.COORDINATE),Cn=S(U,U.RESOLUTION),xt=S(U,U.VIEWPORT),cn=S(U,U.TOP_LEFT);S(U,U.BOTTOM_LEFT);S(U,U.TOP_RIGHT);S(U,U.BOTTOM_RIGHT);T("ViewportNode",U);const Rt=new Ze;class Ht extends _t{constructor(e=cn,t=null,s=null){s===null&&(s=new Xn,s.minFilter=$r),super(s,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=ee.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(Rt);const s=this.value;(s.image.width!==Rt.width||s.image.height!==Rt.height)&&(s.image.width=Rt.width,s.image.height=Rt.height,s.needsUpdate=!0);const o=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(s),s.generateMipmaps=o}clone(){return new this.constructor(this.uvNode,this.levelNode,this.value)}}const ll=N(Ht),dl=N(Ht,null,null,{generateMipmaps:!0});g("viewportTexture",ll);g("viewportMipTexture",dl);T("ViewportTextureNode",Ht);let pt=null;class ei extends Ht{constructor(e=cn,t=null){pt===null&&(pt=new Bs,pt.minFilter=Xr,pt.type=qr,pt.format=jr),super(e,t,pt)}}const ti=N(ei);g("viewportDepthTexture",ti);T("ViewportDepthTextureNode",ei);class pe extends R{constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===pe.DEPTH_PIXEL?e.getFragDepth():super.generate(e)}setup(){const{scope:e}=this;let t=null;if(e===pe.DEPTH)t=Ds(Ue.z,ms,fs);else if(e===pe.DEPTH_TEXTURE){const s=this.valueNode||ti(),o=si(s,ms,fs);t=Ds(o,ms,fs)}else e===pe.DEPTH_PIXEL&&this.valueNode!==null&&(t=ni().assign(this.valueNode));return t}}const Ds=(n,e,t)=>n.add(e).div(e.sub(t)),si=(n,e,t)=>e.mul(t).div(t.sub(e).mul(n).sub(t));pe.DEPTH="depth";pe.DEPTH_TEXTURE="depthTexture";pe.DEPTH_PIXEL="depthPixel";const ni=N(pe,pe.DEPTH_PIXEL);S(pe,pe.DEPTH);N(pe,pe.DEPTH_TEXTURE);const oi=S(pe,pe.DEPTH_PIXEL);oi.assign=n=>ni(n);T("ViewportDepthNode",pe);const Fs=new Map;class Oe extends Yr{constructor(){super(),this.isNodeMaterial=!0,this.type=this.constructor.type,this.forceSinglePass=!1,this.fog=!0,this.lights=!0,this.normals=!0,this.colorSpaced=!0,this.lightsNode=null,this.envNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.depthNode=null,this.outputNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+Jn(this)}build(e){this.setup(e)}setup(e){e.addStack(),e.stack.outputNode=this.vertexNode||this.setupPosition(e),e.addFlow("vertex",e.removeStack()),e.addStack();let t;if(this.fragmentNode===null){this.depthWrite===!0&&this.setupDepth(e),this.normals===!0&&this.setupNormal(e),this.setupDiffuseColor(e),this.setupVariants(e);const s=this.setupLighting(e);t=this.setupOutput(e,P(s,ge.a)),Nc.assign(t),this.outputNode!==null&&(t=this.outputNode)}else t=this.setupOutput(e,this.fragmentNode);e.stack.outputNode=t,e.addFlow("fragment",e.removeStack())}setupDepth(e){const{renderer:t}=e;let s=this.depthNode;s===null&&t.logarithmicDepthBuffer===!0&&(s=En().w.add(1).log2().mul(Au).mul(.5)),s!==null&&oi.assign(s).append()}setupPosition(e){const{object:t}=e,s=t.geometry;e.addStack(),(s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color)&&sl(t).append(),t.isSkinnedMesh===!0&&el(t).append(),t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&e.isAvailable("instance")===!0&&Ku(t).append(),this.positionNode!==null&&ve.assign(this.positionNode);const o=En();return e.context.vertex=e.removeStack(),e.context.mvp=o,o}setupDiffuseColor({geometry:e}){let t=this.colorNode?P(this.colorNode):Ft;this.vertexColors===!0&&e.hasAttribute("color")&&(t=P(t.xyz.mul(Ne("color","vec3")),t.a)),ge.assign(t);const s=this.opacityNode?h(this.opacityNode):Do;if(ge.a.assign(ge.a.mul(s)),this.alphaTestNode!==null||this.alphaTest>0){const o=this.alphaTestNode!==null?h(this.alphaTestNode):Cu;ge.a.lessThanEqual(o).discard()}}setupVariants(){}setupNormal(){if(this.flatShading===!0){const e=Ue.dFdx().cross(Ue.dFdy()).normalize();Q.assign(e)}else{const e=this.normalNode?y(this.normalNode):Fu;Q.assign(e)}}getEnvNode(e){let t=null;return this.envNode?t=this.envNode:this.envMap?t=this.envMap.isCubeTexture?an(this.envMap):De(this.envMap):e.environmentNode&&(t=e.environmentNode),t}setupLights(e){const t=this.getEnvNode(e),s=[];t&&s.push(new Qo(t)),e.material.aoMap&&s.push(new qo(De(e.material.aoMap)));let o=this.lightsNode||e.lightsNode;return s.length>0&&(o=rl([...o.lightNodes,...s])),o}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:s,backdropAlphaNode:o,emissiveNode:i}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let c=ge.rgb;if(a&&a.hasLight!==!1){const u=this.setupLightingModel(e);c=Yo(a,u,s,o)}else s!==null&&(c=y(o!==null?ke(c,s,o):s));return(i&&i.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(c=c.add(y(i||wu))),c}setupOutput(e,t){const s=e.renderer,o=e.toneMappingNode;if(this.toneMapped===!0&&o&&(t=P(o.context({color:t.rgb}),t.a)),this.fog===!0){const i=e.fogNode;i&&(t=P(i.mixAssign(t.rgb),t.a))}if(this.colorSpaced===!0){const i=s.currentColorSpace;i!==ns&&i!==Jr&&(t=t.linearToColorSpace(i))}return t}setDefaultValues(e){for(const s in e){const o=e[s];this[s]===void 0&&(this[s]=o,o&&o.clone&&(this[s]=o.clone()))}Object.assign(this.defines,e.defines);const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const s in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,s)===void 0&&t[s].get!==void 0&&Object.defineProperty(this.constructor.prototype,s,t[s])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const s=Zr.prototype.toJSON.call(this,e),o=qt(this);s.inputNodes={};for(const{property:r,childNode:a}of o)s.inputNodes[r]=a.toJSON(e).uuid;function i(r){const a=[];for(const c in r){const u=r[c];delete u.metadata,a.push(u)}return a}if(t){const r=i(e.textures),a=i(e.images),c=i(e.nodes);r.length>0&&(s.textures=r),a.length>0&&(s.images=a),c.length>0&&(s.nodes=c)}return s}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.depthNode=e.depthNode,this.outputNode=e.outputNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}static fromMaterial(e){if(e.isNodeMaterial===!0)return e;const t=e.type.replace("Material","NodeMaterial"),s=hl(t);if(s===void 0)throw new Error(`NodeMaterial: Material "${e.type}" is not compatible.`);for(const o in e)s[o]=e[o];return s}}function Ee(n,e){if(typeof e!="function"||!n)throw new Error(`Node material ${n} is not a class`);if(Fs.has(n)){console.warn(`Redefinition of node material ${n}`);return}Fs.set(n,e),e.type=n}function hl(n){const e=Fs.get(n);if(e!==void 0)return new e}Ee("NodeMaterial",Oe);class un extends R{constructor(e,t,s=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=s}getNodeType(e){const t=this.ifNode.getNodeType(e);if(this.elseNode!==null){const s=this.elseNode.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(t))return s}return t}generate(e){const t=this.getNodeType(e),s={tempWrite:!1},{ifNode:o,elseNode:i}=this,r=o.getNodeType(e)!=="void"||i&&i.getNodeType(e)!=="void",a=r?Ce(t).build(e):"",c=Xe(this.condNode).build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${c} ) {

`).addFlowTab();let u=Xe(this.ifNode,s).build(e,t);if(u=r?a+" = "+u+";":u,e.removeFlowTab().addFlowCode(e.tab+"	"+u+`

`+e.tab+"}"),i!==null){e.addFlowCode(` else {

`).addFlowTab();let l=Xe(i,s).build(e,t);l=a?a+" = "+l+";":l,e.removeFlowTab().addFlowCode(e.tab+"	"+l+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return a}}const Ke=N(un);g("cond",Ke);T("CondNode",un);class ii extends R{constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}add(e){return this.nodes.push(e),this}if(e,t){const s=new Lt(t);return this._currentCond=Ke(e,s),this.add(this._currentCond)}elseif(e,t){const s=new Lt(t),o=Ke(e,s);return this._currentCond.elseNode=o,this._currentCond=o,this}else(e){return this._currentCond.elseNode=new Lt(e),this}build(e,...t){const s=Wa();vn(this);for(const o of this.nodes)o.build(e,"void");return vn(s),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}}N(ii);T("StackNode",ii);class ri extends R{constructor(e){super(),this.types=e,this.isStructTypeNode=!0}getMemberTypes(){return this.types}}T("StructTypeNode",ri);class ai extends R{constructor(...e){super(),this.isOutputStructNode=!0,this.members=e}setup(e){super.setup(e);const t=this.members,s=[];for(let o=0;o<t.length;o++)s.push(t[o].getNodeType(e));this.nodeType=e.getStructTypeFromNode(new ri(s)).name}generate(e,t){const s=e.getVarFromNode(this);s.isOutputStructVar=!0;const o=e.getPropertyName(s),i=this.members,r=o!==""?o+".":"";for(let a=0;a<i.length;a++){const c=i[a].build(e,t);e.addLineFlowCode(`${r}m${a} = ${c}`)}return o}}N(ai);T("OutputStructNode",ai);class ci extends R{constructor(e){super(),this.seedNode=e}setup(){const e=this.seedNode.uint().mul(747796405).add(2891336453),t=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return t.shiftRight(22).bitXor(t).float().mul(1/2**32)}}const pl=N(ci);g("hash",pl);T("HashNode",ci);let Ts;class ui extends un{constructor(e){Ts=Ts||tn("discard"),super(e,Ts)}}const ml=N(ui),fl=n=>ml(n).append();g("discard",fl);T("DiscardNode",ui);class li extends R{constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFnCall=null}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(e){const t=this.parametersNodes;let s=this._candidateFnCall;if(s===null){let o=null,i=-1;for(const r of this.functionNodes){const c=r.shaderNode.layout;if(c===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const u=c.inputs;if(t.length===u.length){let l=0;for(let m=0;m<t.length;m++){const f=t[m],x=u[m];f.getNodeType(e)===x.type?l++:l=0}l>i&&(o=r,i=l)}}this._candidateFnCall=s=o(...t)}return s}}const gl=N(li),be=n=>(...e)=>gl(n,...e);T("FunctionOverloadingNode",li);class di extends R{constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const s={};for(let o=0,i=this.params.length-1;o<i;o++){const r=this.params[o],a=r.isNode!==!0&&r.name||this.getVarName(o),c=r.isNode!==!0&&r.type||"int";s[a]=tn(a,c)}return t.returnsNode=this.params[this.params.length-1](s,e.addStack(),e),t.stackNode=e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),s={tempWrite:!1},o=this.params,i=t.stackNode;for(let c=0,u=o.length-1;c<u;c++){const l=o[c];let m=null,f=null,x=null,V=null,M=null,w=null;l.isNode?(V="int",x=this.getVarName(c),m="0",f=l.build(e,V),M="<"):(V=l.type||"int",x=l.name||this.getVarName(c),m=l.start,f=l.end,M=l.condition,w=l.update,typeof m=="number"?m=m.toString():m&&m.isNode&&(m=m.build(e,V)),typeof f=="number"?f=f.toString():f&&f.isNode&&(f=f.build(e,V)),m!==void 0&&f===void 0?(m=m+" - 1",f="0",M=">="):f!==void 0&&m===void 0&&(m="0",M="<"),M===void 0&&(Number(m)>Number(f)?M=">=":M="<"));const L={start:m,end:f,condition:M},b=L.start,I=L.end;let D="",de="",z="";w||(V==="int"?M.includes("<")?w="++":w="--":M.includes("<")?w="+= 1":w="-= 1"),D+=e.getVar(V,x)+" = "+b,de+=x+" "+M+" "+I,z+=x+" "+w;const ie=`for ( ${D}; ${de}; ${z} )`;e.addFlowCode((c===0?`
`:"")+e.tab+ie+` {

`).addFlowTab()}const r=Xe(i,s).build(e,"void"),a=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+r);for(let c=0,u=this.params.length-1;c<u;c++)e.addFlowCode((c===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),a}}const le=(...n)=>A(new di(Nt(n,"int"))).append();g("loop",(n,...e)=>ho(n,le(...e)));T("LoopNode",di);class hi extends ${constructor(){super("vec2")}setup(){const e=y(ce.z,0,ce.x.negate()).normalize(),t=ce.cross(e);return C(e.dot(Q),t.dot(Q)).mul(.495).add(.5)}}S(hi);T("MatcapUVNode",hi);class Te extends et{constructor(e=Te.LOCAL,t=1,s=0){super(s),this.scope=e,this.scale=t,this.updateType=ee.FRAME}update(e){const t=this.scope,s=this.scale;t===Te.LOCAL?this.value+=e.deltaTime*s:t===Te.DELTA?this.value=e.deltaTime*s:t===Te.FRAME?this.value=e.frameId:this.value=e.time*s}serialize(e){super.serialize(e),e.scope=this.scope,e.scale=this.scale}deserialize(e){super.deserialize(e),this.scope=e.scope,this.scale=e.scale}}Te.LOCAL="local";Te.GLOBAL="global";Te.DELTA="delta";Te.FRAME="frame";const Nl=(n,e=0)=>A(new Te(Te.LOCAL,n,e));S(Te,Te.FRAME).uint();T("TimerNode",Te);class ne extends R{constructor(e=ne.SINE,t=Nl()){super(),this.method=e,this.timeNode=t}getNodeType(e){return this.timeNode.getNodeType(e)}setup(){const e=this.method,t=A(this.timeNode);let s=null;return e===ne.SINE?s=t.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5):e===ne.SQUARE?s=t.fract().round():e===ne.TRIANGLE?s=t.add(.5).fract().mul(2).sub(1).abs():e===ne.SAWTOOTH&&(s=t.fract()),s}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}ne.SINE="sine";ne.SQUARE="square";ne.TRIANGLE="triangle";ne.SAWTOOTH="sawtooth";N(ne,ne.SINE);N(ne,ne.SQUARE);N(ne,ne.TRIANGLE);N(ne,ne.SAWTOOTH);T("OscNode",ne);class Be extends ${constructor(e,t){super(),this.scope=e,this.node=t}getNodeType(e){return this.node.getNodeType(e)}setup(){const{scope:e,node:t}=this;let s=null;return e===Be.DIRECTION_TO_COLOR?s=t.mul(.5).add(.5):e===Be.COLOR_TO_DIRECTION&&(s=t.mul(2).sub(1)),s}}Be.DIRECTION_TO_COLOR="directionToColor";Be.COLOR_TO_DIRECTION="colorToDirection";const pi=N(Be,Be.DIRECTION_TO_COLOR),yl=N(Be,Be.COLOR_TO_DIRECTION);g("directionToColor",pi);g("colorToDirection",yl);T("PackingNode",Be);class ln extends R{constructor(e,t,s,o=h(0),i=h(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=s,this.outLowNode=o,this.outHighNode=i,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:s,outLowNode:o,outHighNode:i,doClamp:r}=this;let a=e.sub(t).div(s.sub(t));return r===!0&&(a=a.clamp()),a.mul(i.sub(o)).add(o)}}const xl=N(ln,null,null,{doClamp:!1}),Tl=N(ln);g("remap",xl);g("remapClamp",Tl);T("RemapNode",ln);class mi extends ${constructor(e,t,s=C(.5)){super("vec2"),this.uvNode=e,this.rotationNode=t,this.centerNode=s}setup(){const{uvNode:e,rotationNode:t,centerNode:s}=this,o=t.cos(),i=t.sin(),r=e.sub(s);return C(C(o,i).dot(r),C(i.negate(),o).dot(r)).add(s)}}const vl=N(mi);g("rotateUV",vl);T("RotateUVNode",mi);class fi extends R{constructor(e,t=tt(),s=h(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=s}setup(){const{frameNode:e,uvNode:t,countNode:s}=this,{width:o,height:i}=s,r=e.mod(o.mul(i)).floor(),a=r.mod(o),c=i.sub(r.add(1).div(o).ceil()),u=s.reciprocal(),l=C(a,c);return t.add(l).mul(u)}}N(fi);T("SpriteSheetUVNode",fi);class gi extends R{constructor(e,t=null,s=null,o=h(1),i=ve,r=je){super("vec4"),this.textureXNode=e,this.textureYNode=t,this.textureZNode=s,this.scaleNode=o,this.positionNode=i,this.normalNode=r}setup(){const{textureXNode:e,textureYNode:t,textureZNode:s,scaleNode:o,positionNode:i,normalNode:r}=this;let a=r.abs().normalize();a=a.div(a.dot(y(1)));const c=i.yz.mul(o),u=i.zx.mul(o),l=i.xy.mul(o),m=e.value,f=t!==null?t.value:m,x=s!==null?s.value:m,V=De(m,c).mul(a.x),M=De(f,u).mul(a.y),w=De(x,l).mul(a.z);return Le(V,M,w)}}const Vl=N(gi),_l=(...n)=>Vl(...n);g("triplanarTexture",_l);T("TriplanarTexturesNode",gi);class oe extends R{constructor(e=oe.LOCAL){super("vec3"),this.scope=e}getHash(){return`bitangent-${this.scope}`}generate(e){const t=this.scope;let s;t===oe.GEOMETRY?s=Kt.cross(Qt):t===oe.LOCAL?s=je.cross(rn):t===oe.VIEW?s=Qe.cross(cs):t===oe.WORLD&&(s=bo.cross(Qu));const o=s.mul(Qt.w).xyz;return we(J(o)).build(e,this.getNodeType(e))}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}oe.GEOMETRY="geometry";oe.LOCAL="local";oe.VIEW="view";oe.WORLD="world";S(oe,oe.GEOMETRY);S(oe,oe.LOCAL);const Sl=S(oe,oe.VIEW);S(oe,oe.WORLD);const El=we(Q.cross(Go).mul(Qt.w));we(El.transformDirection(st));T("BitangentNode",oe);const ls=1/6,Ni=n=>q(ls,q(n,q(n,n.negate().add(3)).sub(3)).add(1)),zs=n=>q(ls,q(n,q(n,q(3,n).sub(6))).add(4)),yi=n=>q(ls,q(n,q(n,q(-3,n).add(3)).add(3)).add(1)),Ps=n=>q(ls,en(n,3)),Ln=n=>Ni(n).add(zs(n)),wn=n=>yi(n).add(Ps(n)),In=n=>Le(-1,zs(n).div(Ni(n).add(zs(n)))),On=n=>Le(1,Ps(n).div(yi(n).add(Ps(n)))),bn=(n,e,t)=>{const s=n.uvNode,o=q(s,e.zw).add(.5),i=Bt(o),r=Qs(o),a=Ln(r.x),c=wn(r.x),u=In(r.x),l=On(r.x),m=In(r.y),f=On(r.y),x=C(i.x.add(u),i.y.add(m)).sub(.5).mul(e.xy),V=C(i.x.add(l),i.y.add(m)).sub(.5).mul(e.xy),M=C(i.x.add(u),i.y.add(f)).sub(.5).mul(e.xy),w=C(i.x.add(l),i.y.add(f)).sub(.5).mul(e.xy),L=Ln(r.y).mul(Le(a.mul(n.uv(x).level(t)),c.mul(n.uv(V).level(t)))),b=wn(r.y).mul(Le(a.mul(n.uv(M).level(t)),c.mul(n.uv(w).level(t))));return L.add(b)},Ml=(n,e)=>{const t=C(n.size(d(e))),s=C(n.size(d(e.add(1)))),o=bt(1,t),i=bt(1,s),r=bn(n,P(o,t),Bt(e)),a=bn(n,P(i,s),So(e));return Qs(e).mix(r,a)};class xi extends ${constructor(e,t=h(3)){super("vec4"),this.textureNode=e,this.blurNode=t}setup(){return Ml(this.textureNode,this.blurNode)}}const Al=N(xi);g("bicubic",Al);T("TextureBicubicNode",xi);class Ti extends R{constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}S(Ti);T("PointUVNode",Ti);class Fe extends R{constructor(e=Fe.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,s=this.scene!==null?this.scene:e.scene;let o;return t===Fe.BACKGROUND_BLURRINESS?o=ct("backgroundBlurriness","float",s):t===Fe.BACKGROUND_INTENSITY?o=ct("backgroundIntensity","float",s):console.error("THREE.SceneNode: Unknown scope:",t),o}}Fe.BACKGROUND_BLURRINESS="backgroundBlurriness";Fe.BACKGROUND_INTENSITY="backgroundIntensity";S(Fe,Fe.BACKGROUND_BLURRINESS);S(Fe,Fe.BACKGROUND_INTENSITY);T("SceneNode",Fe);class Rl extends on{constructor(e,t,s=0){super(e,t,s),this.isStorageBufferNode=!0}getInputType(){return"storageBuffer"}}T("StorageBufferNode",Rl);class vi extends _t{constructor(e,t,s=null){super(e,t),this.storeNode=s,this.isStoreTextureNode=!0}getNodeType(){return"void"}}N(vi);T("TextureStoreNode",vi);class Cl extends Gt{constructor(e,t,s=null){super(e,t,s),this.userData=s}update(e){this.reference=this.userData!==null?this.userData:e.object.userData,super.update(e)}}T("UserDataNode",Cl);const Ll=v(({base:n,blend:e})=>{const t=s=>e[s].lessThan(_o).cond(e[s],n[s].oneMinus().div(e[s]).oneMinus().max(0));return y(t("x"),t("y"),t("z"))}),wl=v(({base:n,blend:e})=>{const t=s=>e[s].equal(1).cond(e[s],n[s].div(e[s].oneMinus()).max(0));return y(t("x"),t("y"),t("z"))}),Il=v(({base:n,blend:e})=>{const t=s=>n[s].oneMinus().mul(e[s].oneMinus()).oneMinus();return y(t("x"),t("y"),t("z"))}),Ol=v(({base:n,blend:e})=>{const t=s=>n[s].lessThan(.5).cond(n[s].mul(e[s],2),n[s].oneMinus().mul(e[s].oneMinus()).oneMinus());return y(t("x"),t("y"),t("z"))});class ue extends ${constructor(e,t,s){super(),this.blendMode=e,this.baseNode=t,this.blendNode=s}setup(){const{blendMode:e,baseNode:t,blendNode:s}=this,o={base:t,blend:s};let i=null;return e===ue.BURN?i=Ll(o):e===ue.DODGE?i=wl(o):e===ue.SCREEN?i=Il(o):e===ue.OVERLAY&&(i=Ol(o)),i}}ue.BURN="burn";ue.DODGE="dodge";ue.SCREEN="screen";ue.OVERLAY="overlay";const bl=N(ue,ue.BURN),Dl=N(ue,ue.DODGE),Fl=N(ue,ue.OVERLAY),zl=N(ue,ue.SCREEN);g("burn",bl);g("dodge",Dl);g("overlay",Fl);g("screen",zl);T("BlendModeNode",ue);class Vi extends R{constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){return e.getFrontFacing()}}const Pl=S(Vi),_i=h(Pl).mul(2).sub(1);T("FrontFacingNode",Vi);const Ul=v(({textureNode:n,bumpScale:e})=>{let t=n;if(t.isTextureNode!==!0&&t.traverse(r=>{r.isTextureNode===!0&&(t=r)}),t.isTextureNode!==!0)throw new Error("THREE.TSL: dHdxy_fwd() requires a TextureNode.");const s=h(n),o=t.uvNode||tt(),i=r=>n.cache().context({getUV:()=>r,forceUVContext:!0});return C(h(i(o.add(o.dFdx()))).sub(s),h(i(o.add(o.dFdy()))).sub(s)).mul(e)}),Bl=v(n=>{const{surf_pos:e,surf_norm:t,dHdxy:s}=n,o=e.dFdx().normalize(),i=e.dFdy().normalize(),r=t,a=i.cross(r),c=r.cross(o),u=o.dot(a).mul(_i),l=u.sign().mul(s.x.mul(a).add(s.y.mul(c)));return u.abs().mul(t).sub(l).normalize()});class Si extends ${constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=Ul({textureNode:this.textureNode,bumpScale:e});return Bl({surf_pos:Ue,surf_norm:Qe,dHdxy:t})}}const kl=N(Si);g("bumpMap",kl);T("BumpMapNode",Si);const Gl=v(({color:n,adjustment:e})=>e.mix(Yl(n.rgb),n.rgb)),Hl=v(({color:n,adjustment:e})=>{const t=Le(n.r,n.g,n.b).div(3),s=n.r.max(n.g.max(n.b)),o=s.sub(t).mul(e).mul(-3);return ke(n.rgb,s,o)}),Wl=v(({color:n,adjustment:e})=>{const t=y(.57735,.57735,.57735),s=e.cos();return y(n.rgb.mul(s).add(t.cross(n.rgb).mul(e.sin()).add(t.mul(kt(t,n.rgb).mul(s.oneMinus())))))});class Ve extends ${constructor(e,t,s=h(1)){super("vec3"),this.method=e,this.colorNode=t,this.adjustmentNode=s}setup(){const{method:e,colorNode:t,adjustmentNode:s}=this,o={color:t,adjustment:s};let i=null;return e===Ve.SATURATION?i=Gl(o):e===Ve.VIBRANCE?i=Hl(o):e===Ve.HUE?i=Wl(o):console.error(`${this.type}: Method "${this.method}" not supported!`),i}}Ve.SATURATION="saturation";Ve.VIBRANCE="vibrance";Ve.HUE="hue";const $l=N(Ve,Ve.SATURATION),Xl=N(Ve,Ve.VIBRANCE),ql=N(Ve,Ve.HUE),jl=y(.2125,.7154,.0721),Yl=(n,e=jl)=>kt(n,e);g("saturation",$l);g("vibrance",Xl);g("hue",ql);T("ColorAdjustmentNode",Ve);const Jl=v(n=>{const{eye_pos:e,surf_norm:t,mapN:s,uv:o}=n,i=e.dFdx(),r=e.dFdy(),a=o.dFdx(),c=o.dFdy(),u=t,l=r.cross(u),m=u.cross(i),f=l.mul(a.x).add(m.mul(c.x)),x=l.mul(a.y).add(m.mul(c.y)),V=f.dot(f).max(x.dot(x)),M=_i.mul(V.inverseSqrt());return Le(f.mul(s.x,M),x.mul(s.y,M),u.mul(s.z)).normalize()});class Ei extends ${constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=mn}setup(e){const{normalMapType:t,scaleNode:s}=this;let o=this.node.mul(2).sub(1);s!==null&&(o=y(o.xy.mul(s),o.z));let i=null;return t===Kr?i=Oo.mul(o).normalize():t===mn&&(e.hasGeometryAttribute("tangent")===!0?i=Kl.mul(o).normalize():i=Jl({eye_pos:Ue,surf_norm:Qe,mapN:o,uv:tt()})),i}}const Zl=N(Ei),Kl=Vt(cs,Sl,Qe);g("normalMap",Zl);T("NormalMapNode",Ei);class Mi extends ${constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){const{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const Ql=N(Mi);g("posterize",Ql);T("PosterizeNode",Mi);const ed=v(({color:n,exposure:e})=>n.mul(e).clamp()),td=v(({color:n,exposure:e})=>(n=n.mul(e),n.div(n.add(1)).clamp())),sd=v(({color:n,exposure:e})=>{n=n.mul(e),n=n.sub(.004).max(0);const t=n.mul(n.mul(6.2).add(.5)),s=n.mul(n.mul(6.2).add(1.7)).add(.06);return t.div(s).pow(2.2)}),nd=v(({color:n})=>{const e=n.mul(n.add(.0245786)).sub(90537e-9),t=n.mul(n.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),od=v(({color:n,exposure:e})=>{const t=Vt(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),s=Vt(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return n=n.mul(e).div(.6),n=t.mul(n),n=nd({color:n}),n=s.mul(n),n.clamp()}),id={[Qr]:ed,[ea]:td,[ta]:sd,[sa]:od};class rd extends ${constructor(e=As,t=h(1),s=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=s}getCacheKey(){let e=super.getCacheKey();return e="{toneMapping:"+this.toneMapping+",nodes:"+e+"}",e}setup(e){const t=this.colorNode||e.context.color,s=this.toneMapping;if(s===As)return t;const o={exposure:this.exposureNode,color:t},i=id[s];let r=null;return i?r=i(o):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",s),r=t),r}}T("ToneMappingNode",rd);let vs=null;class Ai extends Ht{constructor(e=cn,t=null){vs===null&&(vs=new Xn),super(e,t,vs)}}const ad=N(Ai);g("viewportSharedTexture",ad);T("ViewportSharedTextureNode",Ai);const cd=new na(-1,1,1,-1,0,1);class ud extends ia{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new fn([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new fn(t,2))}}const ld=new ud;class dd{constructor(e=null){this._mesh=new oa(ld,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,cd)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}const Vs=new dd;class hd extends ${constructor(e,t=2){super(e),this.textureNode=e,this.sigma=t,this.directionNode=C(1),this._invSize=Z(new Ze),this._passDirection=Z(new Ze),this._horizontalRT=new Rs,this._verticalRT=new Rs,this.updateBeforeType=ee.RENDER,this.resolution=new Ze(1,1)}setSize(e,t){e=Math.max(Math.round(e*this.resolution.x),1),t=Math.max(Math.round(t*this.resolution.y),1),this._invSize.value.set(1/e,1/t),this._horizontalRT.setSize(e,t),this._verticalRT.setSize(e,t)}updateBefore(e){const{renderer:t}=e,s=this.textureNode,o=s.value,i=t.getRenderTarget(),r=s.value;Vs.material=this._material,this.setSize(o.image.width,o.image.height),t.setRenderTarget(this._horizontalRT),this._passDirection.value.set(1,0),Vs.render(t),s.value=this._horizontalRT.texture,t.setRenderTarget(this._verticalRT),this._passDirection.value.set(0,1),Vs.render(t),t.setRenderTarget(i),s.value=r}setup(e){const t=this.textureNode;if(t.isTextureNode!==!0)return console.error("GaussianBlurNode requires a TextureNode."),P();const s=t.uvNode||tt(),o=c=>t.cache().context({getUV:()=>c,forceUVContext:!0}),i=v(()=>{const c=3+2*this.sigma,u=this._getCoefficients(c),l=this._invSize,m=C(this.directionNode).mul(this._passDirection),f=h(u[0]).toVar(),x=y(o(s).mul(f)).toVar();for(let V=1;V<c;V++){const M=h(V),w=h(u[V]),L=C(m.mul(l.mul(M))).toVar(),b=y(o(s.add(L))),I=y(o(s.sub(L)));x.addAssign(b.add(I).mul(w)),f.addAssign(q(2,w))}return P(x.div(f),1)}),r=this._material||(this._material=e.createNodeMaterial("MeshBasicNodeMaterial"));r.fragmentNode=i();const a=e.getNodeProperties(this);return a.textureNode=t,De(this._verticalRT.texture)}_getCoefficients(e){const t=[];for(let s=0;s<e;s++)t.push(.39894*Math.exp(-.5*s*s/(e*e))/e);return t}}const pd=(n,e)=>A(new hd(A(n),e));g("gaussianBlur",pd);class Dn extends _t{constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class Wt extends ${constructor(e,t,s){super("vec4"),this.scope=e,this.scene=t,this.camera=s,this._pixelRatio=1,this._width=1,this._height=1;const o=new Bs;o.isRenderTargetTexture=!0,o.type=$n,o.name="PostProcessingDepth";const i=new Rs(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:ra});i.texture.name="PostProcessing",i.depthTexture=o,this.renderTarget=i,this.updateBeforeType=ee.FRAME,this._textureNode=A(new Dn(this,i.texture)),this._depthTextureNode=A(new Dn(this,o)),this._depthNode=null,this._cameraNear=Z(0),this._cameraFar=Z(0),this.isPassNode=!0}isGlobal(){return!0}getTextureNode(){return this._textureNode}getTextureDepthNode(){return this._depthTextureNode}getDepthNode(){if(this._depthNode===null){const e=this._cameraNear,t=this._cameraFar;this._depthNode=Ds(si(this._depthTextureNode,e,t),e,t)}return this._depthNode}setup(){return this.scope===Wt.COLOR?this.getTextureNode():this.getDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:s,camera:o}=this;this._pixelRatio=t.getPixelRatio();const i=t.getSize(new Ze);this.setSize(i.width,i.height);const r=t.toneMapping,a=t.toneMappingNode,c=t.getRenderTarget();this._cameraNear.value=o.near,this._cameraFar.value=o.far,t.toneMapping=As,t.toneMappingNode=null,t.setRenderTarget(this.renderTarget),t.render(s,o),t.toneMapping=r,t.toneMappingNode=a,t.setRenderTarget(c)}setSize(e,t){this._width=e,this._height=t;const s=this._width*this._pixelRatio,o=this._height*this._pixelRatio;this.renderTarget.setSize(s,o)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Wt.COLOR="color";Wt.DEPTH="depth";T("PassNode",Wt);class Ri extends ${constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],s=this.functionNode,o=s.getInputs(e),i=this.parameters;if(Array.isArray(i))for(let a=0;a<i.length;a++){const c=o[a],u=i[a];t.push(u.build(e,c.type))}else for(const a of o){const c=i[a.name];if(c!==void 0)t.push(c.build(e,a.type));else throw new Error(`FunctionCallNode: Input '${a.name}' not found in FunctionNode.`)}return`${s.build(e,"property")}( ${t.join(", ")} )`}}const md=(n,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?Nt(e):as(e[0]),A(new Ri(A(n),e)));g("call",md);T("FunctionCallNode",Ri);class Ci extends R{constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outpuType=null,this.events=new Gn,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(e){this._value!==e&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&this._cache===null&&this.inputType==="URL"&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&e.value!==null&&e.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof e.value=="string"||this.inputType==="Number"&&typeof e.value=="number"||this.inputType==="Vector2"&&e.value.isVector2||this.inputType==="Vector3"&&e.value.isVector3||this.inputType==="Vector4"&&e.value.isVector4||this.inputType==="Color"&&e.value.isColor||this.inputType==="Matrix3"&&e.value.isMatrix3||this.inputType==="Matrix4"&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:h()}serialize(e){super.serialize(e),this.value!==null?this.inputType==="ArrayBuffer"?e.value=Kn(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;e.value!==null&&(e.inputType==="ArrayBuffer"?t=Qn(e.value):e.inputType==="Texture"?t=e.meta.textures[e.value]:t=e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const Xt=N(Ci);g("scriptableValue",Xt);T("ScriptableValueNode",Ci);class Li extends Map{get(e,t=null,...s){if(this.has(e))return super.get(e);if(t!==null){const o=t(...s);return this.set(e,o),o}}}class fd{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const t=this.parameters[e];return t?t.getValue():null}}const _s=new Li;class wi extends R{constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new Li,this._output=Xt(),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){const s=this._outputs;return s[e]===void 0?s[e]=Xt(t):s[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){const s=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),s[e]=t,s[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),s[e]=t,s[e].events.addEventListener("refresh",this.onRefresh)):s[e]===void 0?(s[e]=Xt(t),s[e].events.addEventListener("refresh",this.onRefresh)):s[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){const o=this.getObject()[e];if(typeof o=="function")return o(...t)}async callAsync(e,...t){const o=this.getObject()[e];if(typeof o=="function")return o.constructor.name==="AsyncFunction"?await o(...t):o(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){e!==null?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const e=()=>this.refresh(),t=(u,l)=>this.setOutput(u,l),s=new fd(this),o=_s.get("THREE"),i=_s.get("TSL"),r=this.getMethod(this.codeNode),a=[s,this._local,_s,e,t,o,i];this._object=r(...a);const c=this._object.layout;if(c&&(c.cache===!1&&this._local.clear(),this._output.outputType=c.outputType||null,Array.isArray(c.elements)))for(const u of c.elements){const l=u.id||u.name;u.inputType&&(this.getParameter(l)===void 0&&this.setParameter(l,null),this.getParameter(l).inputType=u.inputType),u.outputType&&(this.getOutput(l)===void 0&&this.setOutput(l,null),this.getOutput(l).outputType=u.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const t in this.parameters){let s=this.parameters[t];s.isScriptableNode&&(s=s.getDefaultOutput()),s.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:h()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const e=["parameters","local","global","refresh","setOutput","THREE","TSL"],s=["layout","init","main","dispose"].join(", "),o="var "+s+`; var output = {};
`,i=`
return { ...output, `+s+" };",r=o+this.codeNode.code+i;return this._method=new Function(...e,r),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}set needsUpdate(e){e===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const gd=N(wi);g("scriptable",gd);T("ScriptableNode",wi);class ds extends R{constructor(e,t){super("float"),this.isFogNode=!0,this.colorNode=e,this.factorNode=t}mixAssign(e){return this.mix(e,this.colorNode)}setup(){return this.factorNode}}const Nd=N(ds);g("fog",Nd);T("FogNode",ds);class Ii extends ds{constructor(e,t,s){super(e),this.isFogRangeNode=!0,this.nearNode=t,this.farNode=s}setup(){return at(this.nearNode,this.farNode,Ue.z.negate())}}const yd=N(Ii);g("rangeFog",yd);T("FogRangeNode",Ii);class Oi extends ds{constructor(e,t){super(e),this.isFogExp2Node=!0,this.densityNode=t}setup(){const e=Ue.z.negate(),t=this.densityNode;return t.mul(t,e,e).negate().exp().oneMinus()}}const xd=N(Oi);g("densityFog",xd);T("FogExp2Node",Oi);let nt=null,ot=null;class bi extends R{constructor(e=h(),t=h()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=e.getTypeLength(it(this.minNode.value)),s=e.getTypeLength(it(this.maxNode.value));return t>s?t:s}getNodeType(e){return e.object.isInstancedMesh===!0?e.getTypeFromLength(this.getVectorLength(e)):"float"}setup(e){const t=e.object;let s=null;if(t.isInstancedMesh===!0){const o=this.minNode.value,i=this.maxNode.value,r=e.getTypeLength(it(o)),a=e.getTypeLength(it(i));nt=nt||new It,ot=ot||new It,nt.setScalar(0),ot.setScalar(0),r===1?nt.setScalar(o):o.isColor?nt.set(o.r,o.g,o.b):nt.set(o.x,o.y,o.z||0,o.w||0),a===1?ot.setScalar(i):i.isColor?ot.set(i.r,i.g,i.b):ot.set(i.x,i.y,i.z||0,i.w||0);const c=4,u=c*t.count,l=new Float32Array(u);for(let f=0;f<u;f++){const x=f%c,V=nt.getComponent(x),M=ot.getComponent(x);l[f]=Hn.lerp(V,M,Math.random())}const m=this.getNodeType(e);s=ko(l,"vec4",t.count).element(fc).convert(m)}else s=h(0);return s}}N(bi);T("RangeNode",bi);class Di extends R{constructor(e,t,s=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=s,this.dispatchCount=0,this.version=1,this.updateBeforeType=ee.OBJECT,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let s=t[0];for(let o=1;o<t.length;o++)s*=t[o];this.dispatchCount=Math.ceil(e/s)}onInit(){}updateBefore({renderer:e}){e.compute(this)}generate(e){const{shaderStage:t}=e;if(t==="compute"){const s=this.computeNode.build(e,"void");s!==""&&e.addLineFlowCode(s)}}}const Td=(n,e,t)=>A(new Di(A(n),e,t));g("compute",Td);T("ComputeNode",Di);class lt extends R{constructor(e=lt.TARGET_DIRECTION,t=null){super(),this.scope=e,this.light=t}setup(){const{scope:e,light:t}=this;let s=null;return e===lt.TARGET_DIRECTION&&(s=st.transformDirection(Os(t).sub(Os(t.target)))),s}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}lt.TARGET_DIRECTION="targetDirection";const Fi=N(lt,lt.TARGET_DIRECTION);T("LightNode",lt);const zi=v(n=>{const{lightDistance:e,cutoffDistance:t,decayExponent:s}=n,o=e.pow(s).max(.01).reciprocal();return t.greaterThan(0).cond(o.mul(e.div(t).pow4().oneMinus().clamp().pow2()),o)});class Pi extends ht{constructor(e=null){super(e),this.cutoffDistanceNode=Z(0),this.decayExponentNode=Z(0)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setup(e){const{colorNode:t,cutoffDistanceNode:s,decayExponentNode:o,light:i}=this,r=e.context.lightingModel,a=Io(i).sub(Ue),c=a.normalize(),u=a.length(),l=zi({lightDistance:u,cutoffDistance:s,decayExponent:o}),m=t.mul(l),f=e.context.reflectedLight;r.direct({lightDirection:c,lightColor:m,reflectedLight:f},e.stack,e)}}T("PointLightNode",Pi);St(aa,Pi);class Ui extends ht{constructor(e=null){super(e)}setup(e){super.setup(e);const t=e.context.lightingModel,s=this.colorNode,o=Fi(this.light),i=e.context.reflectedLight;t.direct({lightDirection:o,lightColor:s,reflectedLight:i},e.stack,e)}}T("DirectionalLightNode",Ui);St(ca,Ui);class dn extends ht{constructor(e=null){super(e),this.coneCosNode=Z(0),this.penumbraCosNode=Z(0),this.cutoffDistanceNode=Z(0),this.decayExponentNode=Z(0)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e){const{coneCosNode:t,penumbraCosNode:s}=this;return at(t,s,e)}setup(e){super.setup(e);const t=e.context.lightingModel,{colorNode:s,cutoffDistanceNode:o,decayExponentNode:i,light:r}=this,a=Io(r).sub(Ue),c=a.normalize(),u=c.dot(Fi(r)),l=this.getSpotAttenuation(u),m=a.length(),f=zi({lightDistance:m,cutoffDistance:o,decayExponent:i}),x=s.mul(l).mul(f),V=e.context.reflectedLight;t.direct({lightDirection:c,lightColor:x,reflectedLight:V},e.stack,e)}}T("SpotLightNode",dn);St(qn,dn);class vd extends qn{constructor(e,t,s,o,i,r){super(e,t,s,o,i,r),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class Bi extends dn{getSpotAttenuation(e){const t=this.light.iesMap;let s=null;if(t&&t.isTexture===!0){const o=e.acos().mul(1/Math.PI);s=De(t,C(o,0),0).r}else s=super.getSpotAttenuation(e);return s}}T("IESSpotLightNode",Bi);St(vd,Bi);class ki extends ht{constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}T("AmbientLightNode",ki);St(ua,ki);class Gi extends ht{constructor(e=null){super(e),this.lightPositionNode=Os(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Z(new Us)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:s,lightDirectionNode:o}=this,r=Qe.dot(o).mul(.5).add(.5),a=ke(s,t,r);e.context.irradiance.addAssign(a)}}T("HemisphereLightNode",Gi);St(la,Gi);const Vd=v(n=>{const e=n.uv.mul(2),t=e.x.floor(),s=e.y.floor();return t.add(s).mod(2).sign()});class Hi extends ${constructor(e=tt()){super("float"),this.uvNode=e}setup(){return Vd({uv:this.uvNode})}}const _d=N(Hi);g("checker",_d);T("CheckerNode",Hi);const Sd=new jn;class Ed extends Oe{constructor(e={}){super(),this.normals=!1,this.lights=!1,this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.pointWidth=1,this.pointColorNode=null,this.setDefaultValues(Sd),this.setupShaders(),this.setValues(e)}setupShaders(){const e=this.alphaToCoverage,t=this.useColor;this.vertexNode=v(()=>{J(C(),"vUv").assign(tt());const s=Ne("instancePosition"),o=Ce("vec4","mvPos");o.assign(ut.mul(P(s,1)));const i=xt.z.div(xt.w),r=He.mul(o),a=Ce("vec2","offset");return a.assign(ye.xy),a.assign(a.mul(Xu)),a.assign(a.div(xt.z)),a.y.assign(a.y.mul(i)),a.assign(a.mul(r.w)),r.assign(r.add(P(a,0,0))),r})(),this.fragmentNode=v(()=>{const s=J(C(),"vUv"),o=Ce("float","alpha");o.assign(1);const i=s.x,r=s.y,a=i.mul(i).add(r.mul(r));if(e){const u=Ce("float","dlen");u.assign(a.fwidth()),o.assign(at(u.oneMinus(),u.add(1),a).oneMinus())}else a.greaterThan(1).discard();let c;return this.pointColorNode?c=this.pointColorNode:t?c=Ne("instanceColor").mul(Ft):c=Ft,P(c,o)})(),this.needsUpdate=!0}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.setupShaders())}}Ee("InstancedPointsNodeMaterial",Ed);const Md=new da;class Ad extends Oe{constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(Md),this.setValues(e)}}Ee("LineBasicNodeMaterial",Ad);const Rd=new Yn;class Cd extends Oe{constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.lights=!1,this.normals=!1,this.setDefaultValues(Rd),this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode,t=this.dashScaleNode?h(this.dashScaleNode):bs,s=this.dashSizeNode?h(this.dashSizeNode):Fo,o=this.dashSizeNode?h(this.dashGapNode):zo;yt.assign(s),Jt.assign(o);const i=J(Ne("lineDistance").mul(t));(e?i.add(e):i).mod(yt.add(Jt)).greaterThan(yt).discard()}}Ee("LineDashedNodeMaterial",Cd);const Ld=new Yn;class wd extends Oe{constructor(e={}){super(),this.normals=!1,this.lights=!1,this.setDefaultValues(Ld),this.useAlphaToCoverage=!0,this.useColor=e.vertexColors,this.useDash=e.dashed,this.useWorldUnits=!1,this.dashOffset=0,this.lineWidth=1,this.lineColorNode=null,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setupShaders(),this.setValues(e)}setupShaders(){const e=this.alphaToCoverage,t=this.useColor,s=this.dashed,o=this.worldUnits,i=v(({start:a,end:c})=>{const u=He.element(2).element(2),f=He.element(3).element(2).mul(-.5).div(u).sub(a.z).div(c.z.sub(a.z));return P(ke(a.xyz,c.xyz,f),c.w)});this.vertexNode=v(()=>{Ye("vec2","vUv").assign(tt());const a=Ne("instanceStart"),c=Ne("instanceEnd"),u=Ce("vec4","start"),l=Ce("vec4","end");u.assign(ut.mul(P(a,1))),l.assign(ut.mul(P(c,1))),o&&(Ye("vec3","worldStart").assign(u.xyz),Ye("vec3","worldEnd").assign(l.xyz));const m=xt.z.div(xt.w),f=He.element(2).element(3).equal(-1);G(f,()=>{G(u.z.lessThan(0).and(l.z.greaterThan(0)),()=>{l.assign(i({start:u,end:l}))}).elseif(l.z.lessThan(0).and(u.z.greaterThanEqual(0)),()=>{u.assign(i({start:l,end:u}))})});const x=He.mul(u),V=He.mul(l),M=x.xyz.div(x.w),w=V.xyz.div(V.w),L=w.xy.sub(M.xy).temp();L.x.assign(L.x.mul(m)),L.assign(L.normalize());const b=Ot(P());if(o){const I=l.xyz.sub(u.xyz).normalize(),D=ye.y.lessThan(.5).cond(u.xyz.cross(I).normalize(),l.xyz.cross(I).normalize());D.assign(ye.x.lessThan(0).cond(D.negate(),D));const de=I.dot(y(0,0,1));s||(u.assign(u.sub(P(I.mul(At).mul(.5),0))),l.assign(l.add(P(I.mul(At).mul(.5),0))),D.assign(D.sub(y(L.mul(de),0))),D.z.assign(D.z.add(.5))),G(ye.y.greaterThan(1).or(ye.y.lessThan(0)),()=>{D.assign(D.add(y(L.mul(2).mul(de),0)))}),D.assign(D.mul(At).mul(.5));const z=Ye("vec4","worldPos");z.assign(ye.y.lessThan(.5).cond(u,l)),z.assign(z.add(P(D,0))),b.assign(He.mul(z));const ie=Ot(y());ie.assign(ye.y.lessThan(.5).cond(M,w)),b.z.assign(ie.z.mul(b.w))}else{const I=Ce("vec2","offset");I.assign(C(L.y,L.x.negate())),L.x.assign(L.x.div(m)),I.x.assign(I.x.div(m)),I.assign(ye.x.lessThan(0).cond(I.negate(),I)),G(ye.y.lessThan(0),()=>{I.assign(I.sub(L))}).elseif(ye.y.greaterThan(1),()=>{I.assign(I.add(L))}),I.assign(I.mul(At)),I.assign(I.div(xt.w)),b.assign(ye.y.lessThan(.5).cond(x,V)),I.assign(I.mul(b.w)),b.assign(b.add(P(I,0,0)))}return b})();const r=v(({p1:a,p2:c,p3:u,p4:l})=>{const m=a.sub(u),f=l.sub(u),x=c.sub(a),V=m.dot(f),M=f.dot(x),w=m.dot(x),L=f.dot(f),I=x.dot(x).mul(L).sub(M.mul(M)),de=V.mul(M).sub(w.mul(L)).div(I).clamp(),z=V.add(M.mul(de)).div(L).clamp();return C(de,z)});this.fragmentNode=v(()=>{const a=Ye("vec2","vUv");if(s){const l=this.offsetNode?h(this.offsetNodeNode):Sn,m=this.dashScaleNode?h(this.dashScaleNode):bs,f=this.dashSizeNode?h(this.dashSizeNode):Fo,x=this.dashSizeNode?h(this.dashGapNode):zo;yt.assign(f),Jt.assign(x);const V=Ne("instanceDistanceStart"),M=Ne("instanceDistanceEnd"),w=ye.y.lessThan(.5).cond(m.mul(V),bs.mul(M)),L=J(w.add(Sn)),b=l?L.add(l):L;a.y.lessThan(-1).or(a.y.greaterThan(1)).discard(),b.mod(yt.add(Jt)).greaterThan(yt).discard()}const c=Ce("float","alpha");if(c.assign(1),o){const l=Ye("vec3","worldStart"),m=Ye("vec3","worldEnd"),f=Ye("vec4","worldPos").xyz.normalize().mul(1e5),x=m.sub(l),V=r({p1:l,p2:m,p3:y(0,0,0),p4:f}),M=l.add(x.mul(V.x)),w=f.mul(V.y),I=M.sub(w).length().div(At);if(!s)if(e){const D=I.fwidth();c.assign(at(D.negate().add(.5),D.add(.5),I).oneMinus())}else I.greaterThan(.5).discard()}else if(e){const l=a.x,m=a.y.greaterThan(0).cond(a.y.sub(1),a.y.add(1)),f=l.mul(l).add(m.mul(m)),x=Ce("float","dlen");x.assign(f.fwidth()),G(a.y.abs().greaterThan(1),()=>{c.assign(at(x.oneMinus(),x.add(1),f).oneMinus())})}else G(a.y.abs().greaterThan(1),()=>{const l=a.x,m=a.y.greaterThan(0).cond(a.y.sub(1),a.y.add(1));l.mul(l).add(m.mul(m)).greaterThan(1).discard()});let u;if(this.lineColorNode)u=this.lineColorNode;else if(t){const l=Ne("instanceColorStart"),m=Ne("instanceColorEnd");u=ye.y.lessThan(.5).cond(l,m).mul(Ft)}else u=Ft;return P(u,c)})(),this.needsUpdate=!0}get worldUnits(){return this.useWorldUnits}set worldUnits(e){this.useWorldUnits!==e&&(this.useWorldUnits=e,this.setupShaders())}get dashed(){return this.useDash}set dashed(e){this.useDash!==e&&(this.useDash=e,this.setupShaders())}get alphaToCoverage(){return this.useAlphaToCoverage}set alphaToCoverage(e){this.useAlphaToCoverage!==e&&(this.useAlphaToCoverage=e,this.setupShaders())}}Ee("Line2NodeMaterial",wd);const Id=new ha;class Od extends Oe{constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.colorSpaced=!1,this.setDefaultValues(Id),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?h(this.opacityNode):Do;ge.assign(P(pi(Q),e))}}Ee("MeshNormalNodeMaterial",Od);const bd=new pa;class Dd extends Oe{constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(bd),this.setValues(e)}}Ee("MeshBasicNodeMaterial",Dd);const zt=v(({f0:n,f90:e,dotVH:t})=>{const s=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return n.mul(s.oneMinus()).add(e.mul(s))}),ts=v(n=>n.diffuseColor.mul(1/Math.PI)),Fd=()=>h(.25),zd=v(({dotNH:n})=>Is.mul(.5/Math.PI).add(1).mul(n.pow(Is))),Pd=v(({lightDirection:n})=>{const e=n.add(ce).normalize(),t=Q.dot(e).clamp(),s=ce.dot(e).clamp(),o=zt({f0:Ge,f90:1,dotVH:s}),i=Fd(),r=zd({dotNH:t});return o.mul(i).mul(r)});class Wi extends fo{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:s}){const i=Q.dot(e).clamp().mul(t);s.directDiffuse.addAssign(i.mul(ts({diffuseColor:ge.rgb}))),this.specular===!0&&s.directSpecular.addAssign(i.mul(Pd({lightDirection:e})).mul(Ou))}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(ts({diffuseColor:ge})))}}const Ud=new ma;class Bd extends Oe{constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Ud),this.setValues(e)}setupLightingModel(){return new Wi(!1)}}Ee("MeshLambertNodeMaterial",Bd);const kd=new fa;class Gd extends Oe{constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(kd),this.setValues(e)}setupLightingModel(){return new Wi}setupVariants(){const e=(this.shininessNode?h(this.shininessNode):Lu).max(1e-4);Is.assign(e);const t=this.specularNode||Iu;Ge.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}Ee("MeshPhongNodeMaterial",Gd);const Hd=v(()=>{const n=Kt.dFdx().abs().max(Kt.dFdy().abs());return n.x.max(n.y).max(n.z)}),Wd=v(n=>{const{roughness:e}=n,t=Hd();let s=e.max(.0525);return s=s.add(t),s=s.min(1),s}),$d=v(n=>{const{alpha:e,dotNL:t,dotNV:s}=n,o=e.pow2(),i=t.mul(o.add(o.oneMinus().mul(s.pow2())).sqrt()),r=s.mul(o.add(o.oneMinus().mul(t.pow2())).sqrt());return bt(.5,i.add(r).max(_o))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),Xd=v(({alpha:n,dotNH:e})=>{const t=n.pow2(),s=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(s.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),Fn=v(n=>{const{lightDirection:e,f0:t,f90:s,roughness:o,iridescenceFresnel:i}=n,r=n.normalView||Q,a=o.pow2(),c=e.add(ce).normalize(),u=r.dot(e).clamp(),l=r.dot(ce).clamp(),m=r.dot(c).clamp(),f=ce.dot(c).clamp();let x=zt({f0:t,f90:s,dotVH:f});i&&(x=Zs.mix(x,i));const V=$d({alpha:a,dotNL:u,dotNV:l}),M=Xd({alpha:a,dotNH:m});return x.mul(V).mul(M)}),$i=v(({roughness:n,dotNV:e})=>{const t=P(-1,-.0275,-.572,.022),s=P(1,.0425,1.04,-.04),o=n.mul(t).add(s),i=o.x.mul(o.x).min(e.mul(-9.28).exp2()).mul(o.x).add(o.y);return C(-1.04,1.04).mul(i).add(o.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),qd=v(n=>{const{dotNV:e,specularColor:t,specularF90:s,roughness:o}=n,i=$i({dotNV:e,roughness:o});return t.mul(i.x).add(s.mul(i.y))}),jd=v(({f:n,f90:e,dotVH:t})=>{const s=t.oneMinus().saturate(),o=s.mul(s),i=s.mul(o,o).clamp(0,.9999);return n.sub(y(e).mul(i)).div(i.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),Yd=v(({roughness:n,dotNH:e})=>{const t=n.pow2(),s=h(1).div(t),i=e.pow2().oneMinus().max(.0078125);return h(2).add(s).mul(i.pow(s.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),Jd=v(({dotNV:n,dotNL:e})=>h(1).div(h(4).mul(e.add(n).sub(e.mul(n))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),Zd=v(({lightDirection:n})=>{const e=n.add(ce).normalize(),t=Q.dot(n).clamp(),s=Q.dot(ce).clamp(),o=Q.dot(e).clamp(),i=Yd({roughness:Js,dotNH:o}),r=Jd({dotNV:s,dotNL:t});return ft.mul(i).mul(r)}),Kd=Vt(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),Qd=n=>{const e=n.sqrt();return y(1).add(e).div(y(1).sub(e))},zn=(n,e)=>n.sub(e).div(n.add(e)).pow2(),eh=(n,e)=>{const t=n.mul(2*Math.PI*1e-9),s=y(54856e-17,44201e-17,52481e-17),o=y(1681e3,1795300,2208400),i=y(43278e5,93046e5,66121e5),r=h(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let a=s.mul(i.mul(2*Math.PI).sqrt()).mul(o.mul(t).add(e).cos()).mul(t.pow2().negate().mul(i).exp());return a=y(a.x.add(r),a.y,a.z).div(10685e-11),Kd.mul(a)},th=v(({outsideIOR:n,eta2:e,cosTheta1:t,thinFilmThickness:s,baseF0:o})=>{const i=ke(n,e,at(0,.03,s)),r=n.div(i).pow2().mul(h(1).sub(t.pow2())),c=h(1).sub(r).sqrt(),u=zn(i,n),l=zt({f0:u,f90:1,dotVH:t}),m=l.oneMinus(),f=i.lessThan(n).cond(Math.PI,0),x=h(Math.PI).sub(f),V=Qd(o.clamp(0,.9999)),M=zn(V,i.vec3()),w=zt({f0:M,f90:1,dotVH:c}),L=y(V.x.lessThan(i).cond(Math.PI,0),V.y.lessThan(i).cond(Math.PI,0),V.z.lessThan(i).cond(Math.PI,0)),b=i.mul(s,c,2),I=y(x).add(L),D=l.mul(w).clamp(1e-5,.9999),de=D.sqrt(),z=m.pow2().mul(w).div(y(1).sub(D));let re=l.add(z),hs=z.sub(m);for(let $t=1;$t<=2;++$t){hs=hs.mul(de);const Lr=eh(h($t).mul(b),h($t).mul(I)).mul(2);re=re.add(hs.mul(Lr))}return re.max(y(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),sh=v(({normal:n,viewDir:e,roughness:t})=>{const s=n.dot(e).saturate(),o=t.pow2(),i=Ke(t.lessThan(.25),h(-339.2).mul(o).add(h(161.4).mul(t)).sub(25.9),h(-8.48).mul(o).add(h(14.3).mul(t)).sub(9.95)),r=Ke(t.lessThan(.25),h(44).mul(o).sub(h(23.7).mul(t)).add(3.26),h(1.97).mul(o).sub(h(3.27).mul(t)).add(.72));return Ke(t.lessThan(.25),0,h(.1).mul(t).sub(.025)).add(i.mul(s).add(r).exp()).mul(1/Math.PI).saturate()}),Ss=y(.04),Es=y(1);class Xi extends fo{constructor(e=!1,t=!1,s=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=s,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(){if(this.clearcoat===!0&&(this.clearcoatRadiance=y().temp("clearcoatRadiance"),this.clearcoatSpecularDirect=y().temp("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=y().temp("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=y().temp("sheenSpecularDirect"),this.sheenSpecularIndirect=y().temp("sheenSpecularIndirect")),this.iridescence===!0){const e=Q.dot(ce).clamp();this.iridescenceFresnel=th({outsideIOR:h(1),eta2:No,cosTheta1:e,thinFilmThickness:yo,baseF0:Ge}),this.iridescenceF0=jd({f:this.iridescenceFresnel,f90:1,dotVH:e})}}computeMultiscattering(e,t,s=h(1)){const o=Q.dot(ce).clamp(),i=$i({roughness:wt,dotNV:o}),a=(this.iridescenceF0?Zs.mix(Ge,this.iridescenceF0):Ge).mul(i.x).add(s.mul(i.y)),u=i.x.add(i.y).oneMinus(),l=Ge.add(Ge.oneMinus().mul(.047619)),m=a.mul(l).div(u.mul(l).oneMinus());e.addAssign(a),t.addAssign(m.mul(u))}direct({lightDirection:e,lightColor:t,reflectedLight:s}){const i=Q.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(i.mul(Zd({lightDirection:e}))),this.clearcoat===!0){const a=gt.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(a.mul(Fn({lightDirection:e,f0:Ss,f90:Es,roughness:Yt,normalView:gt})))}s.directDiffuse.addAssign(i.mul(ts({diffuseColor:ge.rgb}))),s.directSpecular.addAssign(i.mul(Fn({lightDirection:e,f0:Ge,f90:1,roughness:wt,iridescence:this.iridescence,iridescenceFresnel:this.iridescenceFresnel})))}indirectDiffuse({irradiance:e,reflectedLight:t}){t.indirectDiffuse.addAssign(e.mul(ts({diffuseColor:ge})))}indirectSpecular({radiance:e,iblIrradiance:t,reflectedLight:s}){if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(t.mul(ft,sh({normal:Q,viewDir:ce,roughness:Js}))),this.clearcoat===!0){const u=gt.dot(ce).clamp(),l=qd({dotNV:u,specularColor:Ss,specularF90:Es,roughness:Yt});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(l))}const o=y().temp("singleScattering"),i=y().temp("multiScattering"),r=t.mul(1/Math.PI);this.computeMultiscattering(o,i);const a=o.add(i),c=ge.mul(a.r.max(a.g).max(a.b).oneMinus());s.indirectSpecular.addAssign(e.mul(o)),s.indirectSpecular.addAssign(i.mul(r)),s.indirectDiffuse.addAssign(c.mul(r))}ambientOcclusion({ambientOcclusion:e,reflectedLight:t}){const o=Q.dot(ce).clamp().add(e),i=wt.mul(-16).oneMinus().negate().exp2(),r=e.sub(o.pow(i).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(e),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(e),t.indirectDiffuse.mulAssign(e),t.indirectSpecular.mulAssign(r)}finish(e){const{outgoingLight:t}=e;if(this.clearcoat===!0){const s=gt.dot(ce).clamp(),o=zt({dotVH:s,f0:Ss,f90:Es}),i=t.mul(ws.mul(o).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(ws));t.assign(i)}if(this.sheen===!0){const s=ft.r.max(ft.g).max(ft.b).mul(.157).oneMinus(),o=t.mul(s).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(o)}}}const nh=new ga;class qi extends Oe{constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(nh),this.setValues(e)}setupLightingModel(){return new Xi}setupVariants(){const e=this.metalnessNode?h(this.metalnessNode):Du;gc.assign(e);let t=this.roughnessNode?h(this.roughnessNode):bu;t=Wd({roughness:t}),wt.assign(t);const s=ke(y(.04),ge.rgb,e);Ge.assign(s),ge.assign(P(ge.rgb.mul(e.oneMinus()),ge.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}Ee("MeshStandardNodeMaterial",qi);const oh=new Na;class ih extends qi{constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.setDefaultValues(oh),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}setupLightingModel(){return new Xi(this.useClearcoat,this.useSheen,this.useIridescence)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?h(this.clearcoatNode):zu,s=this.clearcoatRoughnessNode?h(this.clearcoatRoughnessNode):Pu;ws.assign(t),Yt.assign(s)}if(this.useSheen){const t=this.sheenNode?y(this.sheenNode):ku,s=this.sheenRoughnessNode?h(this.sheenRoughnessNode):Gu;ft.assign(t),Js.assign(s)}if(this.useIridescence){const t=this.iridescenceNode?h(this.iridescenceNode):Hu,s=this.iridescenceIORNode?h(this.iridescenceIORNode):Wu,o=this.iridescenceThicknessNode?h(this.iridescenceThicknessNode):$u;Zs.assign(t),No.assign(s),yo.assign(o)}}setupNormal(e){super.setupNormal(e);const t=this.clearcoatNormalNode?y(this.clearcoatNormalNode):Uu;gt.assign(t)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,super.copy(e)}}Ee("MeshPhysicalNodeMaterial",ih);const rh=new jn;class ah extends Oe{constructor(e){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.normals=!1,this.transparent=!0,this.sizeNode=null,this.setDefaultValues(rh),this.setValues(e)}copy(e){return this.sizeNode=e.sizeNode,super.copy(e)}}Ee("PointsNodeMaterial",ah);const ch=new ya;class uh extends Oe{constructor(e){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this.normals=!1,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(ch),this.setValues(e)}setupPosition({object:e,context:t}){const{positionNode:s,rotationNode:o,scaleNode:i}=this,r=ve;let a=ut.mul(y(s||0)),c=C(Zt[0].xyz.length(),Zt[1].xyz.length());i!==null&&(c=c.mul(i));let u=r.xy;e.center&&e.center.isVector2===!0&&(u=u.sub(Z(e.center).sub(.5))),u=u.mul(c);const l=h(o||Bu),m=l.cos(),f=l.sin(),x=C(C(m,f.negate()).dot(u),C(f,m).dot(u));a=P(a.xy.add(x),a.zw);const V=He.mul(a);return t.vertex=r,V}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}}Ee("SpriteNodeMaterial",uh);const Tt=v(([n,e,t])=>{const s=h(t).toVar(),o=h(e).toVar(),i=qe(n).toVar();return Ke(i,o,s)}),Pt=v(([n,e])=>{const t=qe(e).toVar(),s=h(n).toVar();return Ke(t,s.negate(),s)}),j=v(([n])=>{const e=h(n).toVar();return d(Bt(e))}),H=v(([n,e])=>{const t=h(n).toVar();return e.assign(j(t)),t.sub(h(e))}),ji=v(([n,e,t,s,o,i])=>{const r=h(i).toVar(),a=h(o).toVar(),c=h(s).toVar(),u=h(t).toVar(),l=h(e).toVar(),m=h(n).toVar(),f=h(he(1,a)).toVar();return he(1,r).mul(m.mul(f).add(l.mul(a))).add(r.mul(u.mul(f).add(c.mul(a))))}),Yi=v(([n,e,t,s,o,i])=>{const r=h(i).toVar(),a=h(o).toVar(),c=y(s).toVar(),u=y(t).toVar(),l=y(e).toVar(),m=y(n).toVar(),f=h(he(1,a)).toVar();return he(1,r).mul(m.mul(f).add(l.mul(a))).add(r.mul(u.mul(f).add(c.mul(a))))}),Ji=be([ji,Yi]),Zi=v(([n,e,t,s,o,i,r,a,c,u,l])=>{const m=h(l).toVar(),f=h(u).toVar(),x=h(c).toVar(),V=h(a).toVar(),M=h(r).toVar(),w=h(i).toVar(),L=h(o).toVar(),b=h(s).toVar(),I=h(t).toVar(),D=h(e).toVar(),de=h(n).toVar(),z=h(he(1,x)).toVar(),ie=h(he(1,f)).toVar();return h(he(1,m)).toVar().mul(ie.mul(de.mul(z).add(D.mul(x))).add(f.mul(I.mul(z).add(b.mul(x))))).add(m.mul(ie.mul(L.mul(z).add(w.mul(x))).add(f.mul(M.mul(z).add(V.mul(x))))))}),Ki=v(([n,e,t,s,o,i,r,a,c,u,l])=>{const m=h(l).toVar(),f=h(u).toVar(),x=h(c).toVar(),V=y(a).toVar(),M=y(r).toVar(),w=y(i).toVar(),L=y(o).toVar(),b=y(s).toVar(),I=y(t).toVar(),D=y(e).toVar(),de=y(n).toVar(),z=h(he(1,x)).toVar(),ie=h(he(1,f)).toVar();return h(he(1,m)).toVar().mul(ie.mul(de.mul(z).add(D.mul(x))).add(f.mul(I.mul(z).add(b.mul(x))))).add(m.mul(ie.mul(L.mul(z).add(w.mul(x))).add(f.mul(M.mul(z).add(V.mul(x))))))}),Qi=be([Zi,Ki]),er=v(([n,e,t])=>{const s=h(t).toVar(),o=h(e).toVar(),i=E(n).toVar(),r=E(i.bitAnd(E(7))).toVar(),a=h(Tt(r.lessThan(E(4)),o,s)).toVar(),c=h(q(2,Tt(r.lessThan(E(4)),s,o))).toVar();return Pt(a,qe(r.bitAnd(E(1)))).add(Pt(c,qe(r.bitAnd(E(2)))))}),tr=v(([n,e,t,s])=>{const o=h(s).toVar(),i=h(t).toVar(),r=h(e).toVar(),a=E(n).toVar(),c=E(a.bitAnd(E(15))).toVar(),u=h(Tt(c.lessThan(E(8)),r,i)).toVar(),l=h(Tt(c.lessThan(E(4)),i,Tt(c.equal(E(12)).or(c.equal(E(14))),r,o))).toVar();return Pt(u,qe(c.bitAnd(E(1)))).add(Pt(l,qe(c.bitAnd(E(2)))))}),ae=be([er,tr]),sr=v(([n,e,t])=>{const s=h(t).toVar(),o=h(e).toVar(),i=Ut(n).toVar();return y(ae(i.x,o,s),ae(i.y,o,s),ae(i.z,o,s))}),nr=v(([n,e,t,s])=>{const o=h(s).toVar(),i=h(t).toVar(),r=h(e).toVar(),a=Ut(n).toVar();return y(ae(a.x,r,i,o),ae(a.y,r,i,o),ae(a.z,r,i,o))}),Me=be([sr,nr]),or=v(([n])=>{const e=h(n).toVar();return q(.6616,e)}),ir=v(([n])=>{const e=h(n).toVar();return q(.982,e)}),rr=v(([n])=>{const e=y(n).toVar();return q(.6616,e)}),ar=be([or,rr]),cr=v(([n])=>{const e=y(n).toVar();return q(.982,e)}),ur=be([ir,cr]),xe=v(([n,e])=>{const t=d(e).toVar(),s=E(n).toVar();return s.shiftLeft(t).bitOr(s.shiftRight(d(32).sub(t)))}),lr=v(([n,e,t])=>{n.subAssign(t),n.bitXorAssign(xe(t,d(4))),t.addAssign(e),e.subAssign(n),e.bitXorAssign(xe(n,d(6))),n.addAssign(t),t.subAssign(e),t.bitXorAssign(xe(e,d(8))),e.addAssign(n),n.subAssign(t),n.bitXorAssign(xe(t,d(16))),t.addAssign(e),e.subAssign(n),e.bitXorAssign(xe(n,d(19))),n.addAssign(t),t.subAssign(e),t.bitXorAssign(xe(e,d(4))),e.addAssign(n)}),Et=v(([n,e,t])=>{const s=E(t).toVar(),o=E(e).toVar(),i=E(n).toVar();return s.bitXorAssign(o),s.subAssign(xe(o,d(14))),i.bitXorAssign(s),i.subAssign(xe(s,d(11))),o.bitXorAssign(i),o.subAssign(xe(i,d(25))),s.bitXorAssign(o),s.subAssign(xe(o,d(16))),i.bitXorAssign(s),i.subAssign(xe(s,d(4))),o.bitXorAssign(i),o.subAssign(xe(i,d(14))),s.bitXorAssign(o),s.subAssign(xe(o,d(24))),s}),me=v(([n])=>{const e=E(n).toVar();return h(e).div(h(E(d(4294967295))))}),ze=v(([n])=>{const e=h(n).toVar();return e.mul(e.mul(e.mul(e.mul(e.mul(6).sub(15)).add(10))))}),dr=v(([n])=>{const e=d(n).toVar(),t=E(E(1)).toVar(),s=E(E(d(3735928559)).add(t.shiftLeft(E(2)).add(E(13)))).toVar();return Et(s.add(E(e)),s,s)}),hr=v(([n,e])=>{const t=d(e).toVar(),s=d(n).toVar(),o=E(E(2)).toVar(),i=E().toVar(),r=E().toVar(),a=E().toVar();return i.assign(r.assign(a.assign(E(d(3735928559)).add(o.shiftLeft(E(2)).add(E(13)))))),i.addAssign(E(s)),r.addAssign(E(t)),Et(i,r,a)}),pr=v(([n,e,t])=>{const s=d(t).toVar(),o=d(e).toVar(),i=d(n).toVar(),r=E(E(3)).toVar(),a=E().toVar(),c=E().toVar(),u=E().toVar();return a.assign(c.assign(u.assign(E(d(3735928559)).add(r.shiftLeft(E(2)).add(E(13)))))),a.addAssign(E(i)),c.addAssign(E(o)),u.addAssign(E(s)),Et(a,c,u)}),mr=v(([n,e,t,s])=>{const o=d(s).toVar(),i=d(t).toVar(),r=d(e).toVar(),a=d(n).toVar(),c=E(E(4)).toVar(),u=E().toVar(),l=E().toVar(),m=E().toVar();return u.assign(l.assign(m.assign(E(d(3735928559)).add(c.shiftLeft(E(2)).add(E(13)))))),u.addAssign(E(a)),l.addAssign(E(r)),m.addAssign(E(i)),lr(u,l,m),u.addAssign(E(o)),Et(u,l,m)}),fr=v(([n,e,t,s,o])=>{const i=d(o).toVar(),r=d(s).toVar(),a=d(t).toVar(),c=d(e).toVar(),u=d(n).toVar(),l=E(E(5)).toVar(),m=E().toVar(),f=E().toVar(),x=E().toVar();return m.assign(f.assign(x.assign(E(d(3735928559)).add(l.shiftLeft(E(2)).add(E(13)))))),m.addAssign(E(u)),f.addAssign(E(c)),x.addAssign(E(a)),lr(m,f,x),m.addAssign(E(r)),f.addAssign(E(i)),Et(m,f,x)}),B=be([dr,hr,pr,mr,fr]),gr=v(([n,e])=>{const t=d(e).toVar(),s=d(n).toVar(),o=E(B(s,t)).toVar(),i=Ut().toVar();return i.x.assign(o.bitAnd(d(255))),i.y.assign(o.shiftRight(d(8)).bitAnd(d(255))),i.z.assign(o.shiftRight(d(16)).bitAnd(d(255))),i}),Nr=v(([n,e,t])=>{const s=d(t).toVar(),o=d(e).toVar(),i=d(n).toVar(),r=E(B(i,o,s)).toVar(),a=Ut().toVar();return a.x.assign(r.bitAnd(d(255))),a.y.assign(r.shiftRight(d(8)).bitAnd(d(255))),a.z.assign(r.shiftRight(d(16)).bitAnd(d(255))),a}),Ae=be([gr,Nr]),yr=v(([n])=>{const e=C(n).toVar(),t=d().toVar(),s=d().toVar(),o=h(H(e.x,t)).toVar(),i=h(H(e.y,s)).toVar(),r=h(ze(o)).toVar(),a=h(ze(i)).toVar(),c=h(Ji(ae(B(t,s),o,i),ae(B(t.add(d(1)),s),o.sub(1),i),ae(B(t,s.add(d(1))),o,i.sub(1)),ae(B(t.add(d(1)),s.add(d(1))),o.sub(1),i.sub(1)),r,a)).toVar();return ar(c)}),xr=v(([n])=>{const e=y(n).toVar(),t=d().toVar(),s=d().toVar(),o=d().toVar(),i=h(H(e.x,t)).toVar(),r=h(H(e.y,s)).toVar(),a=h(H(e.z,o)).toVar(),c=h(ze(i)).toVar(),u=h(ze(r)).toVar(),l=h(ze(a)).toVar(),m=h(Qi(ae(B(t,s,o),i,r,a),ae(B(t.add(d(1)),s,o),i.sub(1),r,a),ae(B(t,s.add(d(1)),o),i,r.sub(1),a),ae(B(t.add(d(1)),s.add(d(1)),o),i.sub(1),r.sub(1),a),ae(B(t,s,o.add(d(1))),i,r,a.sub(1)),ae(B(t.add(d(1)),s,o.add(d(1))),i.sub(1),r,a.sub(1)),ae(B(t,s.add(d(1)),o.add(d(1))),i,r.sub(1),a.sub(1)),ae(B(t.add(d(1)),s.add(d(1)),o.add(d(1))),i.sub(1),r.sub(1),a.sub(1)),c,u,l)).toVar();return ur(m)}),lh=be([yr,xr]),Tr=v(([n])=>{const e=C(n).toVar(),t=d().toVar(),s=d().toVar(),o=h(H(e.x,t)).toVar(),i=h(H(e.y,s)).toVar(),r=h(ze(o)).toVar(),a=h(ze(i)).toVar(),c=y(Ji(Me(Ae(t,s),o,i),Me(Ae(t.add(d(1)),s),o.sub(1),i),Me(Ae(t,s.add(d(1))),o,i.sub(1)),Me(Ae(t.add(d(1)),s.add(d(1))),o.sub(1),i.sub(1)),r,a)).toVar();return ar(c)}),vr=v(([n])=>{const e=y(n).toVar(),t=d().toVar(),s=d().toVar(),o=d().toVar(),i=h(H(e.x,t)).toVar(),r=h(H(e.y,s)).toVar(),a=h(H(e.z,o)).toVar(),c=h(ze(i)).toVar(),u=h(ze(r)).toVar(),l=h(ze(a)).toVar(),m=y(Qi(Me(Ae(t,s,o),i,r,a),Me(Ae(t.add(d(1)),s,o),i.sub(1),r,a),Me(Ae(t,s.add(d(1)),o),i,r.sub(1),a),Me(Ae(t.add(d(1)),s.add(d(1)),o),i.sub(1),r.sub(1),a),Me(Ae(t,s,o.add(d(1))),i,r,a.sub(1)),Me(Ae(t.add(d(1)),s,o.add(d(1))),i.sub(1),r,a.sub(1)),Me(Ae(t,s.add(d(1)),o.add(d(1))),i,r.sub(1),a.sub(1)),Me(Ae(t.add(d(1)),s.add(d(1)),o.add(d(1))),i.sub(1),r.sub(1),a.sub(1)),c,u,l)).toVar();return ur(m)}),dh=be([Tr,vr]),hh=v(([n])=>{const e=h(n).toVar(),t=d(j(e)).toVar();return me(B(t))}),ph=v(([n])=>{const e=C(n).toVar(),t=d(j(e.x)).toVar(),s=d(j(e.y)).toVar();return me(B(t,s))}),mh=v(([n])=>{const e=y(n).toVar(),t=d(j(e.x)).toVar(),s=d(j(e.y)).toVar(),o=d(j(e.z)).toVar();return me(B(t,s,o))}),fh=v(([n])=>{const e=P(n).toVar(),t=d(j(e.x)).toVar(),s=d(j(e.y)).toVar(),o=d(j(e.z)).toVar(),i=d(j(e.w)).toVar();return me(B(t,s,o,i))}),Vr=v(([n])=>{const e=h(n).toVar(),t=d(j(e)).toVar();return y(me(B(t,d(0))),me(B(t,d(1))),me(B(t,d(2))))}),_r=v(([n])=>{const e=C(n).toVar(),t=d(j(e.x)).toVar(),s=d(j(e.y)).toVar();return y(me(B(t,s,d(0))),me(B(t,s,d(1))),me(B(t,s,d(2))))}),Sr=v(([n])=>{const e=y(n).toVar(),t=d(j(e.x)).toVar(),s=d(j(e.y)).toVar(),o=d(j(e.z)).toVar();return y(me(B(t,s,o,d(0))),me(B(t,s,o,d(1))),me(B(t,s,o,d(2))))}),Er=v(([n])=>{const e=P(n).toVar(),t=d(j(e.x)).toVar(),s=d(j(e.y)).toVar(),o=d(j(e.z)).toVar(),i=d(j(e.w)).toVar();return y(me(B(t,s,o,i,d(0))),me(B(t,s,o,i,d(1))),me(B(t,s,o,i,d(2))))}),Mr=be([Vr,_r,Sr,Er]),ss=v(([n,e,t,s])=>{const o=h(s).toVar(),i=h(t).toVar(),r=d(e).toVar(),a=y(n).toVar(),c=h(0).toVar(),u=h(1).toVar();return le({start:d(0),end:r},({i:l})=>{c.addAssign(u.mul(lh(a))),u.mulAssign(o),a.mulAssign(i)}),c}),Ar=v(([n,e,t,s])=>{const o=h(s).toVar(),i=h(t).toVar(),r=d(e).toVar(),a=y(n).toVar(),c=y(0).toVar(),u=h(1).toVar();return le({start:d(0),end:r},({i:l})=>{c.addAssign(u.mul(dh(a))),u.mulAssign(o),a.mulAssign(i)}),c}),gh=v(([n,e,t,s])=>{const o=h(s).toVar(),i=h(t).toVar(),r=d(e).toVar(),a=y(n).toVar();return C(ss(a,r,i,o),ss(a.add(y(d(19),d(193),d(17))),r,i,o))}),Nh=v(([n,e,t,s])=>{const o=h(s).toVar(),i=h(t).toVar(),r=d(e).toVar(),a=y(n).toVar(),c=y(Ar(a,r,i,o)).toVar(),u=h(ss(a.add(y(d(19),d(193),d(17))),r,i,o)).toVar();return P(c,u)}),Rr=v(([n,e,t,s,o,i,r])=>{const a=d(r).toVar(),c=h(i).toVar(),u=d(o).toVar(),l=d(s).toVar(),m=d(t).toVar(),f=d(e).toVar(),x=C(n).toVar(),V=y(Mr(C(f.add(l),m.add(u)))).toVar(),M=C(V.x,V.y).toVar();M.subAssign(.5),M.mulAssign(c),M.addAssign(.5);const w=C(C(h(f),h(m)).add(M)).toVar(),L=C(w.sub(x)).toVar();return G(a.equal(d(2)),()=>Re(L.x).add(Re(L.y))),G(a.equal(d(3)),()=>rt(Re(L.x),Re(L.y))),kt(L,L)}),Cr=v(([n,e,t,s,o,i,r,a,c])=>{const u=d(c).toVar(),l=h(a).toVar(),m=d(r).toVar(),f=d(i).toVar(),x=d(o).toVar(),V=d(s).toVar(),M=d(t).toVar(),w=d(e).toVar(),L=y(n).toVar(),b=y(Mr(y(w.add(x),M.add(f),V.add(m)))).toVar();b.subAssign(.5),b.mulAssign(l),b.addAssign(.5);const I=y(y(h(w),h(M),h(V)).add(b)).toVar(),D=y(I.sub(L)).toVar();return G(u.equal(d(2)),()=>Re(D.x).add(Re(D.y).add(Re(D.z)))),G(u.equal(d(3)),()=>rt(rt(Re(D.x),Re(D.y)),Re(D.z))),kt(D,D)}),Mt=be([Rr,Cr]),yh=v(([n,e,t])=>{const s=d(t).toVar(),o=h(e).toVar(),i=C(n).toVar(),r=d().toVar(),a=d().toVar(),c=C(H(i.x,r),H(i.y,a)).toVar(),u=h(1e6).toVar();return le({start:-1,end:d(1),name:"x",condition:"<="},({x:l})=>{le({start:-1,end:d(1),name:"y",condition:"<="},({y:m})=>{const f=h(Mt(c,l,m,r,a,o,s)).toVar();u.assign(Dt(u,f))})}),G(s.equal(d(0)),()=>{u.assign(dt(u))}),u}),xh=v(([n,e,t])=>{const s=d(t).toVar(),o=h(e).toVar(),i=C(n).toVar(),r=d().toVar(),a=d().toVar(),c=C(H(i.x,r),H(i.y,a)).toVar(),u=C(1e6,1e6).toVar();return le({start:-1,end:d(1),name:"x",condition:"<="},({x:l})=>{le({start:-1,end:d(1),name:"y",condition:"<="},({y:m})=>{const f=h(Mt(c,l,m,r,a,o,s)).toVar();G(f.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(f)}).elseif(f.lessThan(u.y),()=>{u.y.assign(f)})})}),G(s.equal(d(0)),()=>{u.assign(dt(u))}),u}),Th=v(([n,e,t])=>{const s=d(t).toVar(),o=h(e).toVar(),i=C(n).toVar(),r=d().toVar(),a=d().toVar(),c=C(H(i.x,r),H(i.y,a)).toVar(),u=y(1e6,1e6,1e6).toVar();return le({start:-1,end:d(1),name:"x",condition:"<="},({x:l})=>{le({start:-1,end:d(1),name:"y",condition:"<="},({y:m})=>{const f=h(Mt(c,l,m,r,a,o,s)).toVar();G(f.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(f)}).elseif(f.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(f)}).elseif(f.lessThan(u.z),()=>{u.z.assign(f)})})}),G(s.equal(d(0)),()=>{u.assign(dt(u))}),u}),vh=v(([n,e,t])=>{const s=d(t).toVar(),o=h(e).toVar(),i=y(n).toVar(),r=d().toVar(),a=d().toVar(),c=d().toVar(),u=y(H(i.x,r),H(i.y,a),H(i.z,c)).toVar(),l=h(1e6).toVar();return le({start:-1,end:d(1),name:"x",condition:"<="},({x:m})=>{le({start:-1,end:d(1),name:"y",condition:"<="},({y:f})=>{le({start:-1,end:d(1),name:"z",condition:"<="},({z:x})=>{const V=h(Mt(u,m,f,x,r,a,c,o,s)).toVar();l.assign(Dt(l,V))})})}),G(s.equal(d(0)),()=>{l.assign(dt(l))}),l}),Vh=v(([n,e,t])=>{const s=d(t).toVar(),o=h(e).toVar(),i=y(n).toVar(),r=d().toVar(),a=d().toVar(),c=d().toVar(),u=y(H(i.x,r),H(i.y,a),H(i.z,c)).toVar(),l=C(1e6,1e6).toVar();return le({start:-1,end:d(1),name:"x",condition:"<="},({x:m})=>{le({start:-1,end:d(1),name:"y",condition:"<="},({y:f})=>{le({start:-1,end:d(1),name:"z",condition:"<="},({z:x})=>{const V=h(Mt(u,m,f,x,r,a,c,o,s)).toVar();G(V.lessThan(l.x),()=>{l.y.assign(l.x),l.x.assign(V)}).elseif(V.lessThan(l.y),()=>{l.y.assign(V)})})})}),G(s.equal(d(0)),()=>{l.assign(dt(l))}),l}),_h=v(([n,e,t])=>{const s=d(t).toVar(),o=h(e).toVar(),i=y(n).toVar(),r=d().toVar(),a=d().toVar(),c=d().toVar(),u=y(H(i.x,r),H(i.y,a),H(i.z,c)).toVar(),l=y(1e6,1e6,1e6).toVar();return le({start:-1,end:d(1),name:"x",condition:"<="},({x:m})=>{le({start:-1,end:d(1),name:"y",condition:"<="},({y:f})=>{le({start:-1,end:d(1),name:"z",condition:"<="},({z:x})=>{const V=h(Mt(u,m,f,x,r,a,c,o,s)).toVar();G(V.lessThan(l.x),()=>{l.z.assign(l.y),l.y.assign(l.x),l.x.assign(V)}).elseif(V.lessThan(l.y),()=>{l.z.assign(l.y),l.y.assign(V)}).elseif(V.lessThan(l.z),()=>{l.z.assign(V)})})})}),G(s.equal(d(0)),()=>{l.assign(dt(l))}),l});Tt.setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]});Pt.setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]});j.setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]});ji.setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]});Yi.setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]});Zi.setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]});Ki.setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]});er.setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]});tr.setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]});sr.setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]});nr.setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]});or.setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]});ir.setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]});rr.setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]});cr.setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]});xe.setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]});Et.setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]});me.setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]});ze.setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]});dr.setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]});hr.setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]});pr.setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]});mr.setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]});fr.setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]});gr.setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]});Nr.setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]});yr.setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]});xr.setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]});Tr.setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]});vr.setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]});hh.setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]});ph.setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]});mh.setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]});fh.setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]});Vr.setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]});_r.setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]});Sr.setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]});Er.setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]});ss.setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});Ar.setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});gh.setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});Nh.setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});Rr.setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Cr.setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});yh.setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});xh.setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Th.setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});vh.setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});Vh.setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});_h.setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});const Sh=v(([n])=>{const e=y(n).toVar(),t=h(e.x).toVar(),s=h(e.y).toVar(),o=h(e.z).toVar();G(s.lessThan(1e-4),()=>y(o,o,o)).else(()=>{t.assign(q(6,t.sub(Bt(t))));const i=d(Eo(t)).toVar(),r=h(t.sub(h(i))).toVar(),a=h(o.mul(he(1,s))).toVar(),c=h(o.mul(he(1,s.mul(r)))).toVar(),u=h(o.mul(he(1,s.mul(he(1,r))))).toVar();return G(i.equal(d(0)),()=>y(o,u,a)).elseif(i.equal(d(1)),()=>y(c,o,a)).elseif(i.equal(d(2)),()=>y(a,o,u)).elseif(i.equal(d(3)),()=>y(a,c,o)).elseif(i.equal(d(4)),()=>y(u,a,o)),y(o,a,c)})}),Eh=v(([n])=>{const e=y(n).toVar(),t=h(e.x).toVar(),s=h(e.y).toVar(),o=h(e.z).toVar(),i=h(Dt(t,Dt(s,o))).toVar(),r=h(rt(t,rt(s,o))).toVar(),a=h(r.sub(i)).toVar(),c=h().toVar(),u=h().toVar(),l=h().toVar();return l.assign(r),G(r.greaterThan(0),()=>{u.assign(a.div(r))}).else(()=>{u.assign(0)}),G(u.lessThanEqual(0),()=>{c.assign(0)}).else(()=>{G(t.greaterThanEqual(r),()=>{c.assign(s.sub(o).div(a))}).elseif(s.greaterThanEqual(r),()=>{c.assign(Le(2,o.sub(t).div(a)))}).else(()=>{c.assign(Le(4,t.sub(s).div(a)))}),c.mulAssign(1/6),G(c.lessThan(0),()=>{c.addAssign(1)})}),y(c,u,l)});Sh.setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]});Eh.setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]});const Mh=v(([n])=>{const e=y(n).toVar(),t=ro(Vo(e,y(.04045))).toVar(),s=y(e.div(12.92)).toVar(),o=y(en(rt(e.add(y(.055)),y(0)).div(1.055),y(2.4))).toVar();return ke(s,o,t)});Mh.setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]});const Ah={class:"content"},Rh={class:"word-content"},Ch=["value","onInput"],Lh={key:0},wh={key:1},Ih={href:"https://ko-fi.com/s/16f7e3aad8",target:"_blank",ref:"nofollow"},Oh=["value"],bh={__name:"WordsInput",props:{sn:{type:String,required:!0},needLicense:{type:qe,default:!1},checkSn:{type:qe,default:!0}},emits:["success","params"],setup(n,{emit:e}){Je("#F492F4");const t=Je(""),s=Je(""),o=Je(""),i=n,r=e;let a=Je([{word:""},{word:""},{word:""},{word:""}]);const c=(f,x)=>{s.value="",a.value[f].word=x.target.value},u=f=>{o.value=f.target.value},l=f=>{console.log("custom fontColor",f),t.value=f},m=()=>{xa.debug("onSubmit input",a);for(let M=0;M<a.value.length;M++)if(!a.value[M].word){s.value="Please Input The words!";return}if(i.needLicense&&!o.value){s.value="Please Input License!";return}let f={};f.words=a.value,f.fontColor=t.value;let x=JSON.stringify(f);if(!i.checkSn){console.log("emits params"),r("params",x);return}let V=i.sn;if(i.needLicense)V=o.value;else if(!i.sn){s.value="Error: code sn error!";return}console.log("addCodeParam",V,x),hn.magicCode.addCodeParam(V,x).then(M=>{if(M.code==hn.SUCCESS){let w=M.data;w&&w.status==1&&r("success",w)}else{M.code==1040?s.value="Error: license sn is error":s.value="Error: add error code:"+M.code;return}})};return(f,x)=>(We(),$e("div",Ah,[X("div",Rh,[(We(!0),$e(Bn,null,kn(Ir(a),(V,M)=>(We(),$e("div",{key:M},[x[1]||(x[1]=X("div",{class:"tip_title"},"Enter what you want to express",-1)),X("div",null,[X("input",{value:V.word,class:"input",maxlength:"30",type:"text",onInput:w=>{c(M,w)}},null,40,Ch)]),x[2]||(x[2]=X("div",{class:"bottom"},null,-1))]))),128)),s.value?(We(),$e("div",Lh,Or(s.value),1)):Ms("",!0),br(Aa,{onOnChange:l}),i.needLicense?(We(),$e("div",wh,[x[3]||(x[3]=Un(" License: ")),X("a",Ih,"Get License",512),X("input",{value:o.value,class:"input",maxlength:"48",type:"text",onInput:x[0]||(x[0]=V=>{u(V)})},null,40,Oh),x[4]||(x[4]=X("div",{class:"bottom"},null,-1))])):Ms("",!0),X("div",{class:"button-submit",onClick:m}," Submit ")]),x[5]||(x[5]=X("div",{style:{display:"flex","justify-items":"center","justify-content":"center"}},[X("div",{class:"info-tips"},[X("div",null," Operating Instructions: "),X("div",null," 1.Enter four sentences that you want to express.( 30 character limit ) "),X("div",null," 2.View the dynamic video effects after submission. "),X("div",null," 3.If you want to modify the text content, please check the tutorial of the reset QR code on the back of the product. ")])],-1))]))}},Bh=Pn(bh,[["__scopeId","data-v-8d50f0ff"]]);export{Bh as default};
