import{a as I}from"./request-DanhXGOG.js";import{r as m,d as f,c as g,j as v,t as R,b as j,F as k}from"./index-cHsVPmZ3.js";const C={key:0},M={__name:"QRScan",emits:["success"],setup(F,{expose:h,emit:w}){const u=m(null),n=m(""),y=w;let t="",p="",c=null;const Q=()=>{const s=document.createElement("script");s.src="https://cdn-us.oss-accelerate.aliyuncs.com/system/static/third/opencv-qr/js/OpencvQr.js",s.onload=()=>{t=1,setTimeout(function(){let e=null;if(typeof window.OpencvQr<"u"?(console.log("window.OpencvQr",2),e=window.OpencvQr,t=0):t=3,t==3&&typeof e>"u"&&(console.log("OpencvQr",5),t=5),!e&&t==3||t==5){O();return}console.log("OpencvQr normal"),c=new e({dw:"https://cdn-us.oss-us-west-1.aliyuncs.com/system/static/third/opencv-qr/models/detect.caffemodel",sw:"https://cdn-us.oss-us-west-1.aliyuncs.com/system/static/third/opencv-qr/models/sr.caffemodel"})},100)},s.onerror=function(e){p=e,console.error("Script loading error:",e)},document.head.appendChild(s)},O=()=>{console.log("getRemoteOpencvQrModule"),I.get("https://cdn-us.oss-accelerate.aliyuncs.com/system/static/third/opencv-qr/js/OpencvQr.js").then(e=>{console.log("获取到的JavaScript内容:",e.data);const l=new Function(e.data);c=new l({dw:"https://cdn-us.oss-us-west-1.aliyuncs.com/system/static/third/opencv-qr/models/detect.caffemodel",sw:"https://cdn-us.oss-us-west-1.aliyuncs.com/system/static/third/opencv-qr/models/sr.caffemodel"})}).catch(e=>{console.error("获取文件时出错:",e)})};Q();const _=()=>{if(n.value="",c===null){n.value="Loading, tyr again later "+p+" code:"+t;return}u.value.click()},q=s=>{const e=s.target.files[0],l=new FileReader;l.onload=x=>{const o=new Image;o.onload=()=>{n.value="",console.log("img on load");const a=document.getElementById("canvas");a.width=o.width,a.height=o.height,a.getContext("2d").drawImage(o,0,0,o.width,o.height);const r=c.load("canvas");let i=null;const d=r==null?void 0:r.getInfos();d&&(i=d[0]),console.log("code infos",d),i?y("success",i):(console.log("The QR code is not found."),n.value="The QR code is not found.")},o.src=x.target.result},l.readAsDataURL(e)};return h({selectImage:_}),(s,e)=>(f(),g(k,null,[e[0]||(e[0]=v("canvas",{id:"canvas",width:"400",height:"400",style:{display:"none"}},null,-1)),v("input",{ref_key:"fileInput",ref:u,type:"file",accept:"image/png, image/jpeg",style:{display:"none"},onChange:q},null,544),n.value?(f(),g("div",C,R(n.value),1)):j("",!0)],64))}};export{M as default};
